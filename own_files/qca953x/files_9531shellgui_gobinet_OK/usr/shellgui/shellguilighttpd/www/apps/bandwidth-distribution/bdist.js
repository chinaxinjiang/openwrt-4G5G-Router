function initializePlotsAndTable(){updateInProgress=!1,initFunction()}function initFunction(){pieChartContainer=document.getElementById("pie_chart_container"),null!=pieChartContainer?(doUpdate(),setInterval(doUpdate,2e3)):setTimeout(initFunction,50)}function getHostDisplay(e){var t=getSelectedValue("host_display"),n=e;return"hostname"==t&&null!=ipToHostname[e]&&(n=ipToHostname[e],n=n.length<25?n:n.substr(0,22)+"..."),n}function getHostList(e){var t=[],n=0;for(n=0;n<e.length;n++)t.push(getHostDisplay(e[n]));return t}function doUpdate(){if(!updateInProgress&&null!=pieChartContainer){var e=getSelectedValue("time_frame"),t="",n="",o=0;for(o=0;o<monitorNames.length;o++){var l=monitorNames[o];l.indexOf(e)>=0&&(l.indexOf("upload")>=0&&(n=""+l),l.indexOf("download")>=0&&(t=""+l))}var a=t+" "+n,r="app=bandwidth-usage&action=get_bandwidth&"+getParameterDefinition("monitor",a),s=function(e){if(!e.match(/ERROR/)){var t=parseMonitors(e),o=1,l=0,a=0,r=[];for(l=0;l<t.length;l++){var s=t[l];for(T in s){var i=s[T][0];a=parseInt(s[T][1]),o=i.length>o?i.length:o,r[T]=1}}idList=[];for(T in r)idList.push(T);var d=getSelectedValue("time_interval"),u=getSelectedText("time_interval"),p=[],c=[],g=new Date;g.setTime(1e3*a),g.setUTCMinutes(g.getUTCMinutes()+tzMinutes);var I=g.valueOf()/1e3;timeFrameIntervalData=[];var h;for(h=0;h<o;h++){var l,f=[],m=[];for(l=0;l<t.length;l++){var v,s=t[l],B=[];for(v=0;v<idList.length;v++){var T=idList[v];T=T==currentWanIp?currentLanIp:T;var x=0;if(null!=s[T]){var i=s[T][0];null!=i&&(x=i[i.length-1-h],x=null==x?0:parseFloat(x))}B.push(x),m[v]=null==m[v]?x:m[v]+x}f.push(B)}f.unshift(m),timeFrameIntervalData.push(f);var U=UI.monthNames,y=function(e){var t=""+e;return t=1==t.length?"0"+t:t};g.setTime(1e3*parseInt(I));var C="";if(n.match("minute"))C=""+y(g.getUTCHours())+":"+y(g.getUTCMinutes()),g.setUTCMinutes(g.getUTCMinutes()-1);else if(n.match("hour"))C=""+y(g.getUTCHours())+":"+y(g.getUTCMinutes()),g.setUTCHours(g.getUTCHours()-1);else if(n.match("day"))C=U[g.getUTCMonth()]+" "+g.getUTCDate(),g.setUTCDate(g.getUTCDate()-1);else if(n.match("month"))C=U[g.getUTCMonth()]+" "+g.getUTCFullYear(),g.setUTCMonth(g.getUTCMonth()-1);else{var _=n.split(/-/),o=_.pop(),b=_.pop();C=parseInt(b)>=2419200?U[g.getUTCMonth()]+" "+g.getUTCFullYear()+" "+y(g.getUTCHours())+":"+y(g.getUTCMinutes()):parseInt(b)>=86400?U[g.getUTCMonth()]+" "+y(g.getUTCHours())+":"+y(g.getUTCMinutes()):""+y(g.getUTCHours())+":"+y(g.getUTCMinutes()),g.setTime(g.getTime()-1e3*parseInt(b))}c.push(C),p.push(""+h),I=g.valueOf()/1e3}setAllowableSelections("time_interval",p,c),null==d||0==d?setSelectedValue("time_interval","0"):setSelectedText("time_interval",u)}updateInProgress=!1,resetDisplayInterval()};$.post("/",r,s)}}function resetTimeFrame(){doUpdate()}function resetDisplayInterval(){var e=getPieTotals;if(null!=e&&null!=pieChartContainer&&!updateInProgress&&timeFrameIntervalData.length>0){updateInProgress=!0;var t=getSelectedValue("time_interval");t=null==t?0:t;var n=timeFrameIntervalData[t],o=e(idList,[bndwS.Totl,bndwS.Dnld,bndwS.Upld],getHostList(idList),n,0,9,resetColors);resetColors=!1;var l,a=[];for(l=0;l<idList.length;l++)a.push(l);var r=function(e,t){return idList[e]<idList[t]?1:-1};a.sort(r);var s,i=[bndwS.Totl,bndwS.Down,bndwS.Up],d=[],u=[];for(zeroPies=[],s=0;s<i.length;s++){l=0;var p=!0;for(l=0;l<idList.length;l++)p=p&&0==n[s][l];zeroPies.push(p)}var c=[0,0,0];for(l=0;l<a.length;l++){var g=a[l],I=idList[g];I=I==currentWanIp?currentLanIp:I;var s,h=[getHostDisplay(I)],f=[getHostDisplay(I)];for(s=0;s<i.length;s++){var m=parseBytes(n[s][g]);m=m.replace("ytes",""),h.push(m),f.push(m),c[s]=c[s]+n[s][g]}for(s=0;s<i.length;s++){var v=zeroPies[s]?100/idList.length:100*n[s][g]/o[s],B=""+parseInt(10*v)/10+"%";h.push(B),f.push(B)}d.push(h),u.push(f)}d.push([UI.Sum,parseBytes(c[0]),parseBytes(c[1]),parseBytes(c[2]),"","",""]);var T=[bndwS.Host];for(s=0;s<i.length;s++)T.push(i[s]);for(s=0;s<i.length;s++)T.push(i[s]+" %");var x=parsePieData(u),U=parseLabels(u);if(U.length!==currentLabels.length){for(var y=0;y<U.length;y++)currentLabels=[],currentLabels[y]=U[y];initPies(x)}else updatePies(x);var C=createTr(d);$("#bdist_data_container").empty(),$("#bdist_data_container").append(C),Ha.setFooterPosition(),updateInProgress=!1}}function parsePieData(e){for(var t=[],n=0;n<e.length;n++){var o={};o.label=e[n][0],o.total=e[n][1],o.down=e[n][2],o.up=e[n][3],o.total_pct=e[n][4],o.down_pct=e[n][5],o.up_pct=e[n][6],o.total_data=parseFloat(e[n][4]),o.down_data=parseFloat(e[n][5]),o.up_data=parseFloat(e[n][6]),t.push(o)}return t}function getPieTotals(e,t,n,o,l,a,r,s){for(var i=[0,0,0],d=0;d<3;d++){for(var u=0;u<e.length;u++)i[d]+=o[d][u];0==i[d]&&(i[d]=e.length)}return i}function parseLabels(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][0]);return t}function randomColorFactory(){return Math.round(255*Math.random())}function getPieData(e,t){var n=[];if("total"==t)for(var o=0;o<e.length;o++)n.push(parseFloat(e[o][4]));else if("down"==t)for(var o=0;o<e.length;o++)n.push(parseFloat(e[o][5]));else for(var o=0;o<e.length;o++)n.push(parseFloat(e[o][6]));return n}function getPieLabel(e,t){var n=[];if("total"==t)for(var o=0;o<e.length;o++)n.push(e[o][0]+"_"+e[o][1]+"_"+e[o][4]);else if("down"==t)for(var o=0;o<e.length;o++)n.push(e[o][0]+"_"+e[o][2]+"_"+e[o][5]);else for(var o=0;o<e.length;o++)n.push(e[o][0]+"_"+e[o][3]+"_"+e[o][6]);return n}function createTr(e){for(var t="",n=0;n<e.length;n++){for(var o="",l=0;l<e[n].length;l++)o+="<td>"+e[n][l]+"</td>";t+="<tr>"+o+"</tr>"}return t}function parseMonitors(e){var t,n=[[],[]],o=e.split("\n");parseInt(o.shift());for(t=0;t<o.length;t++)if(o[t].length>0){var l=o[t].split(/[\t ]+/)[0];l=l.match(/download/)?0:1;var a=o[t].split(/[\t ]+/)[1];t++;o[t];t++;o[t];t++;var r=o[t];t++;var s=o[t].split(",");"COMBINED"!=a&&(n[l][a]=[s,r])}return n}function setSelectedValue(e,t,n){var n=null==n?document:n,o=n.getElementById(e),l=!1;for(optionIndex=0;optionIndex<o.options.length&&!l;optionIndex++)l=o.options[optionIndex].value==t,l&&(o.selectedIndex=optionIndex);!l&&o.options.length>0&&o.selectedIndex<0&&(o.selectedIndex=0)}function getSelectedValue(e,t){return t=null==t?document:t,null==t.getElementById(e)?void alert("Error: "+e+" Not Existes"):(selectedIndex=t.getElementById(e).selectedIndex,selectedValue="",selectedIndex>=0&&(selectedValue=t.getElementById(e).options[t.getElementById(e).selectedIndex].value),selectedValue)}function addOptionToSelectElement(e,t,n,o,l){l=null==l?document:l,option=l.createElement("option"),option.text=t,option.value=n;try{l.getElementById(e).add(option,o)}catch(a){null==o?l.getElementById(e).add(option):l.getElementById(e).add(option,o.index)}}function getParameterDefinition(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}function getSelectedText(e,t){return t=null==t?document:t,selectedIndex=t.getElementById(e).selectedIndex,selectedText="",selectedIndex>=0&&(selectedText=t.getElementById(e).options[t.getElementById(e).selectedIndex].text),selectedText}function setAllowableSelections(e,t,n,o){null==o&&(o=document);var l=o.getElementById(e);if(null!=n&&null!=t&&null!=l){var a=!0;if(t.length==l.options.length)for(a=!1,optionIndex=0;optionIndex<l.options.length&&!a;optionIndex++)a=a||l.options[optionIndex].text!=n[optionIndex]||l.options[optionIndex].value!=t[optionIndex];if(a){for(currentSelection=getSelectedValue(e,o),removeAllOptionsFromSelectElement(l),addIndex=0;addIndex<t.length;addIndex++)addOptionToSelectElement(e,n[addIndex],t[addIndex],null,o);setSelectedValue(e,currentSelection,o)}}}function removeAllOptionsFromSelectElement(e){for(;e.length>0;)try{e.remove(0)}catch(t){}}function parseBytes(e,t,n,o){var l;return t="KBytes"!=t&&"MBytes"!=t&&"GBytes"!=t&&"TBytes"!=t?"mixed":t,spcr=null==n||0==n?" ":"",l="mixed"==t&&e>1099511627776||"TBytes"==t?(e/1099511627776).toFixed(o||3)+spcr+(n?UI.TB:UI.TBy):"mixed"==t&&e>1073741824||"GBytes"==t?(e/1073741824).toFixed(o||3)+spcr+(n?UI.GB:UI.GBy):"mixed"==t&&e>1048576||"MBytes"==t?(e/1048576).toFixed(o||3)+spcr+(n?UI.MB:UI.MBy):(e/1024).toFixed(o||3)+spcr+(n?UI.KB:UI.KBy)}function setSelectedText(e,t,n){for(n=null==n?document:n,selectElement=n.getElementById(e),selectionFound=!1,optionIndex=0;optionIndex<selectElement.options.length&&!selectionFound;optionIndex++)selectionFound=selectElement.options[optionIndex].text==t,selectionFound&&(selectElement.selectedIndex=optionIndex);!selectionFound&&selectElement.options.length>0&&selectElement.selectedIndex<0&&(selectElement.selectedIndex=0)}UI.byt="bytes",UI.Bu="B",UI.KB="kB",UI.MB="MB",UI.GB="GB",UI.TB="TB",UI.KB1="kByte",UI.MB1="MByte",UI.GB1="GByte",UI.TB1="TByte",UI.KBy="kBytes",UI.MBy="MBytes",UI.GBy="GBytes",UI.TBy="TBytes",UI.Kbs="kbits/s",UI.KBs="kBytes/s",UI.MBs="MBytes/s";var tzMinutes=480,bndwS=new Object,plotsInitializedToDefaults=!1,updateInProgress=!1,pieChartContainer=null,initialized=!1,timeFrameIntervalData=[],idList=[],resetColors=!1,currentLabels=[],resetPie=!0;$(".tf_btn").click(function(){var e=$(this).prop("id").replace("bdistf_","");$("#time_frame").val("bdist"+e),$(".tf_btn").removeClass("active"),$(this).addClass("active"),resetTimeFrame()});var total_pie,up_pie,down_pie,total_cxt,up_cxt,down_cxt,label_total,label_down,label_up,total_data,down_data,up_data,total_config,down_config,up_config;initializePlotsAndTable();