function getLine(t){$.post("/","app=filebrowser&action=get_line&path="+t,function(t){var a=$(t);$("#data-container").empty().append(a),$("#data-container").find("tr:gt(1)").append('<td><button class="btn btn-warning btn-xs" data-toggle="modal" data-target="#authModal">'+UI.Privilege+'</button><button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#confirmModal">'+UI.Del+"</button></td>"),$("#data-container").find("a").each(function(){$(this).hasClass("fb-desc")&&$(this).parent().next("td").find(".btn-danger").remove()}),$(".fb-dir").each(function(){$(this).hasClass("file-icons")||$(this).html($(this).html()+"/")}),Ha.setFooterPosition(),$("#data-container").find(".btn-danger").click(function(){var t=$(this).parent().parent(),a=t.find("a").attr("data-value"),e=UI.Confirm+" "+UI.Del_file,i=UI.Confirm+" "+UI.Del+" "+a+"?";a="/"==cwd?cwd+a:cwd+"/"+a,console.log(i),Ha.alterModal("confirmModal",e,i,function(){$.post("/","app=filebrowser&action=del_file&file="+a,function(a){Ha.showNotify(a),a.status||t.remove()},"json")})}),$("#data-container").find(".btn-warning").click(function(){var t=$(this).parent().parent(),a=t.find("a").attr("data-value");$("#auth_btn").attr("data-target",a),a="/"==cwd?cwd+a:cwd+"/"+a,$("#authModal").find(".confirm-text").html(a);var e=t.find("pre").html().substring(1,10);$("#auth-btn-group").find(".btn").each(function(t){"-"!=e[t]?$(this).addClass("btn-default"):$(this).removeClass("btn-default")})})})}function setProgressLength(){var t=$("#file_name").width();t<208&&(t=208),$(".upload-progress-bar").css("width",t).removeClass("hidden")}var cwd=old_path?old_path:"/";$("#path-search-input").val(cwd),getLine(cwd),$("#auth-btn-group").find(".btn").click(function(){$(this).hasClass("btn-default")?$(this).removeClass("btn-default"):$(this).addClass("btn-default")}),$("#auth_btn").click(function(){var t=$(this).attr("data-target"),a=$('[data-value="'+t+'"]').parent().parent(),e=a.find("pre").html().substring(1,10);t="/"==cwd?cwd+t:cwd+"/"+t;var i="";$("#auth-btn-group").find(".btn").each(function(){i+=$(this).hasClass("btn-default")?$(this).html():"-"}),$.post("/","app=filebrowser&action=post_privilege&file="+t+"&data="+i,function(t){if(Ha.showNotify(t),t.status);else{var n=a.find("pre").html().replace(e,i);a.find("pre").html(n)}},"json"),$("#authModal").modal("hide")}),$("#data-container").delegate(".fb-dir","click",function(){if($(this).hasClass("file-icons"))return void $(this).next("a").trigger("click");var t;if(t="/"!=cwd?cwd+"/"+$(this).attr("data-value"):cwd+$(this).attr("data-value"),".."==$(this).attr("data-value")){if("/"==cwd)return!1;t=cwd.split("/"),t.pop(),t=t.join("/"),t="/"+t}else"."==$(this).attr("data-value")&&(t=cwd);t=t.replace("//","/"),getLine(t),cwd=t,$("#path-search-input").val(cwd)}),$("#data-container").delegate(".fb-file,.fb-exec","click",function(){if($(this).hasClass("file-icons"))return void $(this).next("a").trigger("click");var t=$(this).attr("data-value");t="/"==cwd?cwd+t:cwd+"/"+t,$.post("/","app=filebrowser&action=test_file&file="+t,function(a){a.status?Ha.showNotify(a):($("#editModal").find(".confirm-text").html(t),$("#edit_file_btn").attr("data-target",t),$.post("/","app=filebrowser&action=get_text_file&file="+t,function(t){$("#file-data-container").val(t),$("#editModal").modal("show")}))},"json")}),$("#edit_file_btn").click(function(){var t=$("#file-data-container").val(),a=$(this).attr("data-target");$.post("/","app=filebrowser&action=post_text_file&file="+a+"&data="+t,function(t){Ha.showNotify(t),$("#editModal").modal("hide")},"json")}),$("#path-submit-form").submit(function(){var t=$("#path-search-input").val();return Validate.vaPath(t)?($(this).prop("disabled",!0),$(this).next(".help-block").removeClass("hidden"),$(this).parent().addClass("has-error")):(getLine(t),cwd=t),!1}),$("#path-search-input").bind("blur keyup",function(){var t=$(this).val();Validate.vaPath(t)?($("#path-search-btn").prop("disabled",!0),$(this).parent().find(".help-block").removeClass("hidden"),$(this).parent().addClass("has-error")):($("#path-search-btn").prop("disabled",!1),$(this).parent().find(".help-block").addClass("hidden"),$(this).parent().removeClass("has-error"))}),$("#upload-btn").click(function(){$("#upload_target").val(cwd),$("#uploadModal").find(".confirm-text").html(UI.Upload_to_dir+":"+cwd),$("#upload-fw").val(""),$("#file_name").html(UI.Upload_File),$("#file_info").addClass("hidden")}),$("#uplevel-btn").click(function(){$("#data-container").find(".fb-dir:eq(3)").trigger("click")}),$("#uploader").ajaxForm({uploadProgress:function(t,a,e,i){var n=i+"%";$(".upload-progress-bar").find("span").css("width",n),$("#progress-text").html(n)},complete:function(t){console.log(t.responseText);var a=$.parseJSON(t.responseText);a.status=parseInt(a.status),a.seconds=parseInt(a.seconds),Ha.showNotify(a),setTimeout(function(){window.location.href=a.jump_url},a.seconds),$("#uploadModal").modal("hide")}}),$("#upload-fw").change(function(){$("#submit-file-btn").prop("disabled",!1);var t=$(this).val(),a=t.split("\\").pop();$("#file_name").html(a);var e=$(this).get(0).files[0];if(e){$("#file_info").removeClass("hidden");var i=0;i=e.size>1048576?(Math.round(100*e.size/1048576)/100).toString()+"MB":(Math.round(100*e.size/1024)/100).toString()+"KB",$("#file_size").html(i||""),$("#file_type").html(e.type||"")}}),$("#uploader").submit(function(){$("#upload-fw").prop("disabled",!0),setProgressLength(),$("#submit-file-btn").prop("disabled",!0)});