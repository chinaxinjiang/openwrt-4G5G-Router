function setCanvasHeight(){var e=$(window).width();e>=768&&($(".canvas_container").empty(),$("#total_container").append('<canvas id="my_total"></canvas>'),$("#download_container").append('<canvas id="my_download" height="200"></canvas>'),$("#upload_container").append('<canvas id="my_upload" height="200"></canvas>'))}function stopInterval(){null!=updateInterval&&clearInterval(updateInterval)}function trim(e){return e?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}function BandwidthCookieContainer(){this.prefix="shellgui.bandwidth_display.",this.set=function(e,t){var o=new Date((new Date).getTime()+864e7);document.cookie=this.prefix+e+"="+escape(t)+";expires="+o.toUTCString()},this.remove=function(e){var t=new Date(0);document.cookie=this.prefix+e+";expires="+t.toUTCString()},this.get=function(e,t){for(var o=document.cookie.split(";"),n=0;n<o.length;n++){var a=o[n].split("=");if(trim(a[0])==this.prefix+e)return trim(a[1])}return t}}function initializePlotsAndTable(){var e=bandwidthSettings.get("plot_time_frame","1"),t=bandwidthSettings.get("table_time_frame","1");setSelectedValue("plot_time_frame",e),setCurrentTimeFrameBtn(e),setSelectedValue("table_time_frame",t),setSelectedValue("table_units","mixed"),document.getElementById("use_high_res_15m").checked="1"==uciOriginal.get("shellgui","bandwidth_display","high_res_15m");var o,n=!1,a=!1,l=!1,i=!1,s=!1,d=!1,r=!1,u=!1;for(o=0;o<monitorNames.length;o++){var p=monitorNames[o];if(p.match(/qos/)){var m=p.match(/up/),c=p.match(/down/);n=n||m,a=a||c;var h=p.split("-");h.shift(),h.shift(),h.pop(),h.pop();var g=h.join("-"),f=uciOriginal.get("qos_shellgui",g,"name");m&&null==definedUploadClasses[g]&&(qosUploadClasses.push(g),qosUploadNames.push(f),definedUploadClasses[g]=1),c&&null==definedDownloadClasses[g]&&(qosDownloadClasses.push(g),qosDownloadNames.push(f),definedDownloadClasses[g]=1)}l=!!p.match(/tor/)||l,i=!!p.match(/openvpn/)||i,s=!!p.match(/shadowvpn/)||s,d=!!p.match(/sslocal/)||d,r=!!p.match(/ssserver/)||r,u=!!p.match(/ssredir/)||u}var v,w=["plot1_type","plot2_type","plot3_type","table_type"];for(v=0;v<w.length;v++){var I=w[v];n&&addOptionToSelectElement(I,UI.QoS_Upload_Class,"qos-upload"),a&&addOptionToSelectElement(I,UI.QoS_Download_Class,"qos-download"),l&&addOptionToSelectElement(I,"Tor","tor"),i&&addOptionToSelectElement(I,"OpenVPN","openvpn"),s&&addOptionToSelectElement(I,"ShadowVPN","shadowvpn"),d&&addOptionToSelectElement(I,"ShadowSocks Local","sslocal"),r&&addOptionToSelectElement(I,"ShadowSocks Server","ssserver"),u&&addOptionToSelectElement(I,"ShadowSocks Redir","ssredir"),addOptionToSelectElement(I,UI.Hostname,"hostname"),addOptionToSelectElement(I,"IP","ip");var b=bandwidthSettings.get(I,"none");setSelectedValue(I,b)}plotsInitializedToDefaults=!1,uploadMonitors=["","",""],downloadMonitors=["","",""],updateInProgress=!1,setTimeout(resetPlots,150),updateInterval=setInterval(doUpdate,2e3)}function getMonitorId(e,t,o,n,a){var l,i=null,s="",d="",r=uciOriginal.get("shellgui","bandwidth_display","high_res_15m");if(t=1!=t||"total"==o||o.match(/tor/)||o.match(/openvpn/)||o.match(/shadowvpn/)||o.match(/sslocal/)||o.match(/ssserver/)||o.match(/ssredir/)||"1"!=r||a?t:0,"total"==o?s=a?"bdist"+t:"total"+t:o.match(/qos/)?e&&o.match(/up/)||!e&&o.match(/down/)?(s="qos"+t,d=n):o="none":o.match(/tor/)?s=a?"tor-lr"+t:"tor-hr"+t:o.match(/openvpn/)?s=a?"openvpn-lr"+t:"openvpn-hr"+t:o.match(/shadowvpn/)?s=a?"shadowvpn-lr"+t:"shadowvpn-hr"+t:o.match(/sslocal/)?s=a?"sslocal-lr"+t:"sslocal-hr"+t:o.match(/ssserver/)?s=a?"ssserver-lr"+t:"ssserver-hr"+t:o.match(/ssredir/)?s=a?"ssredir-lr"+t:"ssredir-hr"+t:"ip"!=o&&"hostname"!=o||(s="bdist"+t),"none"!=o)for(l=0;l<monitorNames.length&&null==i;l++){var u=monitorNames[l];!(u.match("up")&&e||u.match("down")&&!e)||""!=s&&!u.match(s)||""!=d&&!u.match(d)||(i=u)}return i}function getHostnameList(e){var t=[],o=0;for(o=0;o<e.length;o++){var n=e[o],a=null==ipToHostname[n]?n:ipToHostname[n];a=a.length<25?a:a.substr(0,22)+"...",t.push(a)}return t}function resetPlots(){if(window.my_total_line&&(window.my_total_line=void 0),window.my_upload_line&&(window.my_upload_line=void 0),window.my_download_line&&(window.my_download_line=void 0),updateInProgress||null==updateTotalPlot||null==updateUploadPlot||null==updateDownloadPlot)setTimeout(resetPlots,25),null!=updateTotalPlot&&null!=updateDownloadPlot&&null!=updateUploadPlot||(updateTotalPlot=updateTotalLine,updateDownloadPlot=updateDownloadLine,updateUploadPlot=updateUploadLine);else{updateInProgress=!0;var e=tableDownloadMonitor,t=tableUploadMonitor,o=downloadMonitors.join("\n")+"\n",n=uploadMonitors.join("\n");uploadMonitors=[],downloadMonitors=[];var a,l=getSelectedValue("plot_time_frame"),i=getSelectedValue("table_time_frame"),s=!1;for(a=1;a<=3;a++){var d=getSelectedValue("plot"+a+"_type"),r=1==l&&"1"==uciOriginal.get("shellgui","bandwidth_display","high_res_15m");s=s||"total"!=d&&"none"!=d&&"tor"!=d&&"openvpn"!=d&&"shadowvpn"!=d&&"sslocal"!=d&&"ssserver"!=d&&"ssredir"!=d&&!r}for(a=1;a<=4;a++){var u=a<4?"plot"+a+"_id":"table_id",p=a<4?u:u+"_container",m=a<4?"plot"+a+"_type":"table_type",c=getSelectedValue(m),h=getSelectedValue(u);if(h=null==h?"":h,"ip"==c||"hostname"==c?(null==h.match(/^[0-9]+\./)&&("hostname"==c?setAllowableSelections(u,ipsWithData,getHostnameList(ipsWithData)):setAllowableSelections(u,ipsWithData,ipsWithData),setSelectedValue(u,ipsWithData[0]),h=null==ipsWithData[0]?"":ipsWithData[0]),$("#"+p).removeClass("hidden")):"qos-upload"==c?(null==definedUploadClasses[h]&&(setAllowableSelections(u,qosUploadClasses,qosUploadNames),h=qosUploadClasses[0]),$("#"+p).removeClass("hidden")):"qos-download"==c?(null==definedDownloadClasses[h]&&(setAllowableSelections(u,qosDownloadClasses,qosDownloadNames),h=qosDownloadClasses[0]),$("#"+p).removeClass("hidden")):$("#"+p).addClass("hidden"),!plotsInitializedToDefaults&&""!=c&&"none"!=c&&"total"!=c&&"tor"!=c&&"openvpn"!=c&&"shadowvpn"!=c&&"sslocal"!=c&&"ssserver"!=c&&"ssredir"!=c){var g=bandwidthSettings.get(u,"none");""==g||"ip"!=c&&"hostname"!=c||setAllowableSelections(u,[g],[g]),setSelectedValue(u,g),h=g}if(4!=a)uploadMonitors[a-1]=getMonitorId(!0,l,c,h,s),downloadMonitors[a-1]=getMonitorId(!1,l,c,h,s),uploadMonitors[a-1]=null==uploadMonitors[a-1]?"":uploadMonitors[a-1],downloadMonitors[a-1]=null==downloadMonitors[a-1]?"":downloadMonitors[a-1];else{var f="total"!=c||4!=i;i=f?i:5,tableUploadMonitor=getMonitorId(!0,i,c,h,f),tableDownloadMonitor=getMonitorId(!1,i,c,h,f),tableUploadMonitor=null==tableUploadMonitor?"":tableUploadMonitor,tableDownloadMonitor=null==tableDownloadMonitor?"":tableDownloadMonitor}}for(plotsInitializedToDefaults=!0,updateInProgress=!1,n==uploadMonitors.join("\n")&&o==downloadMonitors.join("\n")&&t==tableUploadMonitor&&e==tableDownloadMonitor||doUpdate(),bandwidthSettings.set("plot_time_frame",getSelectedValue("plot_time_frame")),bandwidthSettings.set("table_time_frame",getSelectedValue("table_time_frame")),a=1;a<=4;a++){var u=a<4?"plot"+a+"_id":"table_id",m=a<4?"plot"+a+"_type":"table_type",c=getSelectedValue(m);bandwidthSettings.set(m,c),""!=c&&"none"!=c&&"total"!=c?bandwidthSettings.set(u,getSelectedValue(u)):(bandwidthSettings.remove(u),bandwidthSettings.remove(m))}}}function updateTotalLine(e,t,o,n,a,l,i){var s=getDisplayData(e,o,t),d=getDisplayTime(e,o,n,a,t),r=getDisplayLabel(e);"undefined"==typeof my_total_line?makeLine("my_total",s,d,i.Total,r):updateLine("my_total",s,d)}function updateDownloadLine(e,t,o,n,a,l,i){var s=getDisplayData(e,o,t),d=getDisplayTime(e,o,n,a,t),r=getDisplayLabel(e);"undefined"==typeof my_download_line?makeLine("my_download",s,d,i.Download,r):updateLine("my_download",s,d)}function updateUploadLine(e,t,o,n,a,l,i){var s=getDisplayData(e,o,t),d=getDisplayTime(e,o,n,a,t),r=getDisplayLabel(e);"undefined"==typeof my_upload_line?makeLine("my_upload",s,d,i.Upload,r):updateLine("my_upload",s,d)}function getDisplayLabel(e){for(var t={},o=0;o<3;o++)if(e[o]){var n=getSelectedValue("plot"+(o+1)+"_type"),a="";"none"!=n&&"total"!=n&&"openvpn"!=n&&"shadowvpn"!=n&&"sslocal"!=n&&"ssserver"!=n&&"ssredir"!=n&&(a="-"+$('[value="'+getSelectedValue("plot"+(o+1)+"_id")+'"]').html()),n=$("#plot"+(o+1)+"_type").find('[value="'+n+'"]').html(),n+=a,t[o]=n}return t}function getDisplayData(e,t,o){for(var n=getIntervalSeconds(t),a={},l=0;l<3;l++)if(e[l]){for(var i=[],s=e[l],d=s.length<parseInt(o)+1?parseInt(o)+1:s.length,r=0;r<d;r++)"undefined"!=typeof s[r]?i.push(Math.round(s[r]/1024/parseInt(n)*100)/100):i.unshift(0);a[l]=i}return a}function getIntervalSeconds(e){var t;return t="minute"==e?60:"hour"==e?3600:"day"==e?24576:"month"==e?12582912:parseInt(e)}function getLastMonth(e){var t=1e3*parseInt(e);t=new Date(t);var o=t.getFullYear(),n=t.getMonth();return 0==n?(o-=1,n=11):n-=1,t.setFullYear(o),t.setMonth(n),t.getTime()/1e3}function getLastYear(e){var t=1e3*parseInt(e);t=new Date(t);var o=t.getFullYear();return t.setFullYear(o-1),t.getTime()/1e3}function getTimeStr(e,t){var o=1e3*parseInt(e);o=new Date(o);var n=o.getFullYear(),a=o.getMonth()+1,l=o.getDate(),i=o.getHours(),s=o.getMinutes(),d=o.getSeconds();return t.replace("YYYY",add0(n)).replace("MM",add0(a)).replace("dd",add0(l)).replace("hh",add0(i)).replace("mm",add0(s)).replace("ss",add0(d))}function makeLine(e,t,o,n,a){var l=[];if(t[0]){var i={label:a[0],data:t[0],pointRadius:0,pointHitRadius:0,fill:!1,borderWidth:1,borderColor:"#5bc0de"};l.push(i)}if(t[1]){var s={label:a[1],data:t[1],pointRadius:0,pointHitRadius:0,fill:!1,borderWidth:1.5,borderColor:"#5cb85c"};l.push(s)}if(t[2]){var d={label:a[2],data:t[2],pointRadius:0,pointHitRadius:0,fill:!1,borderWidth:2,borderColor:"#d9534f"};l.push(d)}var r,u;u=getSelectedValue("plot_time_frame"),r=u>3?u>4?"GByte / day":"MByte / hr":"KByte / s";var p={type:"line",data:{labels:o,datasets:l},options:{animation:{duration:0},responsive:!0,title:{display:!0,text:n},scales:{xAxes:[{display:!0}],yAxes:[{display:!0,beginAtZero:!1,scaleLabel:{display:!0,labelString:r}}]}}},m=document.getElementById(e).getContext("2d");window[e+"_line"]=new Chart(m,p)}function updateLine(e,t,o){var n=[];for(var a in t)n.push(t[a]);for(var l=0;l<window[e+"_line"].config.data.datasets.length;l++)window[e+"_line"].config.data.datasets[l].data=n[l];window[e+"_line"].config.data.labels=o,window[e+"_line"].update()}function getDisplayTime(e,t,o,n,a){var l,i=(getXaxesFormate(),getSelectedValue("plot_time_frame")),s=o;l=1==i?o-900:2==i?o-21600:3==i?o-86400:4==i?getLastMonth(o):getLastYear(o);for(var d,r=0;r<3;r++)if(e[0]||e[1]||e[2]){for(var u=[],p=e[0]||e[1]||e[2],m=p.length<parseInt(a)+1?parseInt(a)+1:p.length,c=0;c<m;c++)u.push("");d=u}else{for(var u=[],m=parseInt(a)+1,c=0;c<m;c++)u.push("");d=u}d[0]=l,d[d.length-1]=s;var h=getTimeLabels();return d=h(d)}function getXaxesFormate(){var e,t,o,n=getSelectedValue("plot_time_frame"),a=getSelectedValue("plot1_type"),l=getSelectedValue("plot2_type"),i=getSelectedValue("plot3_type");return 1==n?(e=5,t=16,o="hh:mm"):2==n?(e=6,t=25,o="hh:00"):3==n?(e=6,t=25,o="hh:00"):4==n?(e=5,t=32,o="MM-dd"):5==n&&(e=6,t=13,o="YYYY-MM月"),"total"==a&&"none"==l&&"none"==i&&(t=450,o="hh:mm:ss"),data={timeFrame:n,labelCounts:e,pointCounts:t,labelFormate:o}}function add0(e){return e>9?e:"0"+e}function get15MinsLabels(e){var t=e.length;e[0],e[t-1];if(16==t){for(var o=1;o<t;o++)e[o]=e[0]+60*o;for(var o=0;o<t;o++)e[o]=getTimeStr(e[o],"hh:mm"),o%3==0&&0!=o||(e[o]="")}else if(450==t){for(var o=t-2;o>=0;o--)e[o]=e[t-1]-2*(449-o);for(var o=0;o<t;o++)e[o]=getTimeStr(e[o],"mm:ss"),o%90!=0&&(e[o]="")}return e}function get6HoursLabels(e){var t=e.length,o=(e[0],e[t-1]);if(25==t){for(var n=t-2;n>=0;n--)e[n]=o-900*(24-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"hh:mm"),"00"!=e[n].split(":").pop()&&(e[n]="")}else if(360==t){for(var n=t-2;n>=0;n--)e[n]=o-60*(359-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"hh:mm"),n%60!=0&&(e[n]="")}return e}function get24HoursLabels(e){var t=e.length,o=(e[0],e[t-1]);if(25==t){for(var n=t-2;n>=0;n--)e[n]=o-3600*(24-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"hh:00"),n%4==0&&0!=n||(e[n]="")}else if(480==t){for(var n=t-2;n>=0;n--)e[n]=o-180*(479-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"hh:mm"),n%80!=0&&(e[n]="")}return e}function get30DaysLabels(e){var t=e.length,o=(e[0],e[t-1]);if(t<50){for(var n=t-2;n>=0;n--)e[n]=o-86400*(t-1-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"MM-dd"),n%5==0&&0!=n||(e[n]="")}else if(t>50){for(var n=t-2;n>=0;n--)e[n]=o-7200*(t-1-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"MM-dd"),n%60!=0&&(e[n]="")}return e}function get1YearLabels(e){var t=e.length,o=(e[0],e[t-1]);if(13==t){for(var n=t-2;n>=0;n--)e[n]=getLastMonth(e[n+1]);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"MM月"),n%2==0&&0!=n||(e[n]="")}else{for(var n=t-2;n>=0;n--)e[n]=o-86400*(t-1-n);for(var n=0;n<t;n++)e[n]=getTimeStr(e[n],"MM-dd"),n%60!=0&&(e[n]="")}return e}function getTimeLabels(){var e,t=getSelectedValue("plot_time_frame");return 1==t?e=get15MinsLabels:2==t?e=get6HoursLabels:3==t?e=get24HoursLabels:4==t?e=get30DaysLabels:5==t&&(e=get1YearLabels),e}function parseMonitors(e){var t=[],o=e.split(/[\r\n]+/),n=parseInt(o.shift());if(""+n=="NaN")return t;var a;for(a=0;a<o.length;a++)if(null!=o[a]&&o[a].length>0&&o[a].match(/ /)){var l=o[a].split(/[\t ]+/)[0],i=o[a].split(/[\t ]+/)[1];a++;o[a];a++;o[a];a++;var s=o[a];if(null!=o[a+1]&&(o[a+1].match(/,/)||o[a+1].match(/^[0-9]+$/))){a++;var d=o[a].split(",");t[l]=null==t[l]?[]:t[l],t[l][i]=[d,s,n],found=1}}return t}function getDisplayIp(e){var t=e;return null!=t&&null!=currentWanIp&&null!=currentLanIp&&""!=t&&(t=t==currentWanIp?currentLanIp:t),t}function getRealIp(e){var t=e;return null!=t&&null!=currentWanIp&&null!=currentLanIp&&""!=currentWanIp&&""!=currentLanIp&&""!=t&&(t=t==currentLanIp?currentWanIp:t),t}function doUpdate(){if(!updateInProgress&&null!=updateUploadPlot&&null!=updateDownloadPlot&&null!=updateTotalPlot){updateInProgress=!0;var e=uploadMonitors.join(" ")+" "+downloadMonitors.join(" ")+" "+tableDownloadMonitor+" "+tableUploadMonitor,t="app=bandwidth-usage&action=get_bandwidth&"+getParameterDefinition("monitor",e),o=function(e){if(4==e.readyState){try{clearTimeout(updateTimeoutId)}catch(t){}if(updateReq=null,e.responseText.length>0&&!e.responseText.match(/ERROR/)){var o=parseMonitors(e.responseText),n=[],a=[],l=[],i=[],s=[],d=0,r=2,u=0,p=2,m=Math.floor((new Date).getTime()/1e3),c=m,h=m;for(monitorIndex=0;monitorIndex<4;monitorIndex++){var g;for(g=0;g<2;g++){var f,v,w=!1;if(monitorIndex<3){var I=0==g?downloadMonitors:uploadMonitors;f=0==g?a:n,v=I[monitorIndex]}else f=i,v=0==g?tableDownloadMonitor:tableUploadMonitor;v=null==v?"":v;var b=monitorIndex<3?"plot"+(monitorIndex+1)+"_type":"table_type",_=getSelectedValue(b),y=""==v?null:o[v];if(null!=y){var T,M=[];for(T in y)(("total"==_||_.match("qos")||_.match("tor")||_.match("openvpn")||_.match("shadowvpn")||_.match("sslocal")||_.match("ssserver")||_.match("ssredir"))&&"COMBINED"==T||"total"!=_&&"COMBINED"!=T)&&M.push(getDisplayIp(T));if(M.length>0){var S=v.split("-");if(monitorIndex<3?(d=S.pop(),r=S.pop()):(u=S.pop(),p=S.pop()),v.match("bdist")&&"total"!=_){var U=monitorIndex<3?"plot"+(monitorIndex+1)+"_id":"table_id";T=getSelectedValue(U),T=null==T?"":getRealIp(T);var x=$("#"+U).val();null==y[T]&&x==T&&(Ha.showNotify({status:2,msg:UI.Host_IP+":"+T+UI.have_nothing_data_at_this_period}),bandwidthSettings.set(U,M[0])),T=null!=y[T]?T:M[0],"hostname"==_?setAllowableSelections(U,M,getHostnameList(M)):setAllowableSelections(U,M,M),ipsWithData=M}else T=M[0];T=null==T?"":getRealIp(T);var D=y[T][0];monitorIndex<3?(m=y[T][1],c=y[T][2]):h=y[T][1];var C;C=monitorIndex<3?null==l[monitorIndex]?[]:l[monitorIndex]:s;var B;for(B=0;B<D.length;B++){var L=D.length-(1+B),P=C.length<D.length?B:C.length-D.length+B;null!=C[P]?C[P]=parseInt(C[P])+parseInt(D[L]):C.push(D[L])}monitorIndex<3&&(l[monitorIndex]=C),f.push(D),w=!0}else if(v.match("bdist")&&monitorIndex<3){var b=monitorIndex<3?"plot"+(monitorIndex+1)+"_type":"table_type",U=monitorIndex<3?"plot"+(monitorIndex+1)+"_id":"table_id";I[monitorIndex]="",setSelectedValue(b,"none"),$("#"+U).addClass("hidden")}}else if(v.match("bdist")&&"total"!=_&&monitorIndex<3){var U=monitorIndex<3?"plot"+(monitorIndex+1)+"_id":"table_id";I[monitorIndex]="",setSelectedValue(b,"none"),$("#"+U).addClass("hidden")}w||f.push(null)}monitorIndex<3?l[monitorIndex]=null==l[monitorIndex]?null:l[monitorIndex].reverse():(s.reverse(),i.unshift(s))}updateTotalPlot(l,d,r,m,c,tzMinutes,UI),updateDownloadPlot(a,d,r,m,c,tzMinutes,UI),updateUploadPlot(n,d,r,m,c,tzMinutes,UI),updateBandwidthTable(i,p,h)}updateInProgress=!1}},n=function(){updateInProgress=!1};updateReq=runAjax("POST","/",t,o),updateTimeoutId=setTimeout(n,5e3)}}function twod(e){var t=""+e;return t=1==t.length?"0"+t:t}function updateBandwidthTable(e,t,o){var n=[],a=0,l=getSelectedValue("table_units"),i=o,s=new Date;s.setTime(1e3*i),s.setUTCMinutes(s.getUTCMinutes()+tzMinutes),"NaN"==parseInt(t)&&(t.match(/month/)||t.match(/day/))&&(s=new Date(s.getTime()+108e5));var d=UI.EMonths;for(a=0;a<e[0].length;a++){var r=0,u=[];for(r=0;r<3;r++){var p=e[r],m=null==p?0:p[p.length-(1+a)];m=null==m?0:m,u.push(parseBytes(m,l))}var c="";t.match(/minute/)?(c=""+twod(s.getUTCHours())+":"+twod(s.getUTCMinutes()),s.setUTCMinutes(s.getUTCMinutes()-1)):t.match(/hour/)?(c=""+twod(s.getUTCHours())+":"+twod(s.getUTCMinutes()),s.setUTCHours(s.getUTCHours()-1)):t.match(/day/)?(c=d[s.getUTCMonth()]+" "+s.getUTCDate(),s.setUTCDate(s.getUTCDate()-1)):t.match(/month/)?(c=d[s.getUTCMonth()]+" "+s.getUTCFullYear(),s.setUTCMonth(s.getUTCMonth()-1)):"NaN"!=parseInt(t)&&(c=parseInt(t)>=2419200?d[s.getUTCMonth()]+" "+s.getUTCFullYear()+" "+twod(s.getUTCHours())+":"+twod(s.getUTCMinutes()):parseInt(t)>=86400?d[s.getUTCMonth()]+" "+twod(s.getUTCHours())+":"+twod(s.getUTCMinutes()):""+twod(s.getUTCHours())+":"+twod(s.getUTCMinutes()),s.setTime(s.getTime()-1e3*parseInt(t))),u.unshift(c),n.push(u),i=s.getTime()/1e3}updateTableData(n)}function highResChanged(){var e=document.getElementById("use_high_res_15m").checked,t=[];t.push("uci set shellgui.bandwidth_display=bandwidth_display"),t.push("uci set shellgui.bandwidth_display.high_res_15m="+(e?"1":"0")),t.push("uci commit"),t.push("/usr/shellgui/progs/bwmond restart");var o=function(e){4==e.readyState},n="app=bandwidth-usage&action=get_bandwidth&monitor=bdist1-upload-minute-15   bdist1-download-minute-15   bdist1-download-minute-15 bdist1-upload-minute-15";runAjax("POST","/",n,o)}function deleteData(){if(0!=confirm(bndwS.DelAD)){setControlsEnabled(!1,!0,bndwS.DelDW);var e=[];e.push("/usr/shellgui/progs/bwmond stop"),e.push("rm /tmp/data/bwmon/*"),e.push("rm /usr/data/bwmon/*"),e.push("/usr/shellgui/progs/bwmond start");var t=function(e){4==e.readyState&&setControlsEnabled(!0)},o="app=bandwidth-usage&action=get_bandwidth&monitor=bdist1-upload-minute-15   bdist1-download-minute-15   bdist1-download-minute-15 bdist1-upload-minute-15";runAjax("POST","/",o,t)}}function setSelectedValue(e,t,o){var o=null==o?document:o,n=o.getElementById(e),a=!1;for(optionIndex=0;optionIndex<n.options.length&&!a;optionIndex++)a=n.options[optionIndex].value==t,a&&(n.selectedIndex=optionIndex);!a&&n.options.length>0&&n.selectedIndex<0&&(n.selectedIndex=0)}function getSelectedValue(e,t){return t=null==t?document:t,null==t.getElementById(e)?void alert(UI.Err+": "+e+" "+UI.nex):(selectedIndex=t.getElementById(e).selectedIndex,selectedValue="",selectedIndex>=0&&(selectedValue=t.getElementById(e).options[t.getElementById(e).selectedIndex].value),selectedValue)}function addOptionToSelectElement(e,t,o,n,a){a=null==a?document:a,option=a.createElement("option"),option.text=t,option.value=o;try{a.getElementById(e).add(option,n)}catch(l){null==n?a.getElementById(e).add(option):a.getElementById(e).add(option,n.index)}}function setBrowserTimeCookie(){var e=Math.floor((new Date).getTime()/1e3);document.cookie="browser_time="+e+"; path=/"}function getParameterDefinition(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}function removeStringFromArray(e,t){var o,n=[];for(o=0;o<e.length;o++){var a=!1;"string"==typeof e[o]&&(a=e[o]==t),a||n.push(e[o])}return n}function runAjax(e,t,o,n){setBrowserTimeCookie();var a=getRequestObj();return a&&(a.onreadystatechange=function(){n(a)},"POST"==e?(o=null==o?" ":o,a.open("POST",t,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(o)):"GET"==e&&(a.open("GET",t+"?"+o,!0),a.send(null))),a}function getRequestObj(){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return!1}}}return e}function setAllowableSelections(e,t,o,n){null==n&&(n=document);var a=n.getElementById(e);if(null!=o&&null!=t&&null!=a){var l=!0;if(t.length==a.options.length)for(l=!1,optionIndex=0;optionIndex<a.options.length&&!l;optionIndex++)l=l||a.options[optionIndex].text!=o[optionIndex]||a.options[optionIndex].value!=t[optionIndex];if(l){for(currentSelection=getSelectedValue(e,n),removeAllOptionsFromSelectElement(a),addIndex=0;addIndex<t.length;addIndex++)addOptionToSelectElement(e,o[addIndex],t[addIndex],null,n);setSelectedValue(e,currentSelection,n)}}}function removeAllOptionsFromSelectElement(e){for(;e.length>0;)try{e.remove(0)}catch(t){}}function parseBytes(e,t,o,n){var a;return t="KBytes"!=t&&"MBytes"!=t&&"GBytes"!=t&&"TBytes"!=t?"mixed":t,spcr=null==o||0==o?" ":"",a="mixed"==t&&e>1099511627776||"TBytes"==t?(e/1099511627776).toFixed(n||3)+spcr+(o?UI.TB:UI.TBy):"mixed"==t&&e>1073741824||"GBytes"==t?(e/1073741824).toFixed(n||3)+spcr+(o?UI.GB:UI.GBy):"mixed"==t&&e>1048576||"MBytes"==t?(e/1048576).toFixed(n||3)+spcr+(o?UI.MB:UI.MBy):(e/1024).toFixed(n||3)+spcr+(o?UI.KB:UI.KBy)}function setCurrentTimeFrameBtn(e){$(".tf_btn").each(function(){$(this).removeClass("active")}),$("#plot_tf_"+e+",#plot_tf_xs_"+e).addClass("active")}function updateTableData(e){$("#bw_table_container").empty();for(var t=0;t<e.length;t++){var o="<tr><td>"+e[t][0]+"</td><td>"+e[t][1]+"</td><td>"+e[t][2]+"</td><td>"+e[t][3]+"</td></tr>";$("#bw_table_container").append(o)}}UI.byt="bytes",UI.Bu="B",UI.KB="kB",UI.MB="MB",UI.GB="GB",UI.TB="TB",UI.KB1="kByte",UI.MB1="MByte",UI.GB1="GByte",UI.TB1="TByte",UI.KBy="kBytes",UI.MBy="MBytes",UI.GBy="GBytes",UI.TBy="TBytes",UI.Kbs="kbits/s",UI.KBs="kBytes/s",UI.MBs="MBytes/s",setBrowserTimeCookie(),$(window).load(setCanvasHeight);var testAjax=getRequestObj(),bndwS=new Object,ipMonitorIds,qosUploadMonitorIds,qosDownloadMonitorIds,uploadMonitors=null,downloadMonitors=null,tableUploadMonitor=null,tableDownloadMonitor=null,ipsWithData=[],qosDownloadClasses=[],qosDownloadNames=[],qosUploadClasses=[],qosUploadNames=[],definedUploadClasses=[],definedDownloadClasses=[],updateTotalPlot=null,updateUploadPlot=null,updateDownloadPlot=null,updateInProgress=!1,plotsInitializedToDefaults=!1,expandedWindows=[],expandedFunctions=[],updateInterval=null;window.onbeforeunload=stopInterval;var bandwidthSettings=new BandwidthCookieContainer,updateReq=null,updateTimeoutId=null;$(".dropdown-menu").find("a").click(function(e){e.preventDefault()}),$("#table_type").change(function(){var e=$(this).val();if("qos-upload"==e||"qos-download"==e||"hostname"==e||"ip"==e){var t=$("#table_id").html();$("#table_id_shown").removeClass("hidden").html(t)}else{var o="";$("#table_id_shown").addClass("hidden").html(o)}$("#table_type_shown").val(e)}),$(".tf_btn").click(function(){var e=$(this).prop("id").split("_").pop();$(".tf_btn").each(function(){$(this).removeClass("active");var t=$(this).prop("id").split("_").pop();t==e&&$(this).addClass("active")}),$("#plot_time_frame").val(e),resetPlots()}),initializePlotsAndTable();