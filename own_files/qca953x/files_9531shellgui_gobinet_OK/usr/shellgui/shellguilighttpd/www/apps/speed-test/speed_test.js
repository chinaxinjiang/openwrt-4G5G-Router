function getTestData(){function t(){$.post("/","app=speed-test&action=do_speedtest&dev="+e,function(a){function r(){o<27?($.post("/","app=speed-test&action=get_line&dev="+e+"&line="+o,function(t){if(!t.status){if(1==o&&$("#loading-text").html("正在获取用户信息..."),2==o&&($("#loading-text").html("正在获取测速点信息..."),showUserInfo(t),loadingServerInfo()),3==o&&($("#loading-text").html("Ping..."),showServerInfo(t),loadingPing()),4==o&&t.tcp_delay&&(tcp_delay=t.tcp_delay,showPingResult(tcp_delay),$("#loading-text").html("开始下载数据..."),hideBtn()),o>=5&&o<=14){var e=parseSpeedData(t.d_speed);downLoadSpeedArr.push(e),$("#loading-text").html("正在测试下载速度..."),updateDownloadChart(),updateDash(e),$("#downloadtext").addClass("hideshowalter")}if(15==o){var e=parseSpeedData(t.speed);downLoadSpeedOri=t.speed,downLoadSpeed=e,downLoadSpeedArr.push(e),$("#loading-text").html("开始上传数据..."),updateDownloadChart(),finishDownloadChart(),$("#downloadtext").removeClass("hideshowalter")}if(o>=16&&o<=25){var e=parseSpeedData(t.u_speed);$("#loading-text").html("正在测试上传速度..."),upLoadSpeedArr.push(e),updateUploadChart(),updateDash(e),$("#uploadtext").addClass("hideshowalter")}if(26==o){var e=parseSpeedData(t.speed);upLoadSpeedOri=t.speed,upLoadSpeed=e,upLoadSpeedArr.push(e),updateUploadChart(),finishUploadChart(),$("#uploadtext").removeClass("hideshowalter")}o++,setSVGSize(),Ha.setFooterPosition()}},"json"),setTimeout(r,500)):(finishTest(),$("#loading-text").html("测速完成，点击按钮重新测速"))}if(a.status)return $("#loading-text").html("查询失败，正在重建查询..."),void setTimeout(t,500);var o=1;setTimeout(r,500)},"json")}var e=$("#dev_select").val();$("#loading-text").html("正在初始化查询..."),t()}function updateDownloadChart(){downloadPoint=parsePoints(downLoadSpeedArr,!1),downloadChartStr=parseChartStr(downloadPoint),downloadPolyStr=parsePolyStr(downloadPoint),setChartPoints(),downloadtext.setAttribute("fill","green"),$("#transLine").addClass("dashline"),$("#dashbg").attr("opacity",1)}function updateUploadChart(){uploadPoint=parsePoints(upLoadSpeedArr,!0),uploadChartStr=parseChartStr(uploadPoint),uploadPolyStr=parsePolyStr(uploadPoint),setChartPoints(!0),uploadtext.setAttribute("fill","green"),$("#transLine").addClass("backdashline"),$("#dashbg").attr("opacity",1)}function updateDash(t){function e(){a>r?n<=r?(arrow.setAttribute("transform","rotate("+r+")"),clearInterval(d)):(n-=1,arrow.setAttribute("transform","rotate("+n+")")):a<r&&(n>=r?(arrow.setAttribute("transform","rotate("+r+")"),clearInterval(d)):(n+=1,arrow.setAttribute("transform","rotate("+n+")")))}t=parseFloat(t);var a=arrow.getAttribute("transform");a=a.replace("rotate(",""),a=a.replace(")",""),a=parseFloat(a);var r=-120,o=addPlaceholder0(t);t>0&&t<=1?r=30*t-120:t>1&&t<=5?r=(t-1)/4*30-90:t>5&&t<=10?r=(t-5)/5*30-60:t>10&&t<=30?r=3*(t-10)-30:t>30&&t<=50?r=(t-30)/2*3+30:t>50&&t<=100&&(r=(t-50)/5*6+60);var n=a,d=setInterval(e,2);setNum(o)}function setNum(t){function e(){if(o.join("")!=n.join(""))for(var e=0;e<4;e++){o[e]=parseInt(o[e]),n[e]=parseInt(n[e]),o[e]>n[e]?o[e]-=1:o[e]<n[e]&&(o[e]+=1);var a=""+o[0]+o[1]+"."+o[2]+o[3];$("#num").html(a)}else clearInterval(d),$("#num").html(t)}var a=$("#num").html().replace(".",""),r=t.replace(".",""),o=a.split(""),n=r.split(""),d=setInterval(e,30)}function finishDownloadChart(){downloadtext.setAttribute("fill","#ccc"),$("#dashbg").attr("opacity",0),$("#downloadresult").html(downLoadSpeed+"Mbps|"+downLoadSpeedOri),$("#transLine").removeClass("dashline")}function finishUploadChart(){uploadtext.setAttribute("fill","#ccc"),$("#dashbg").attr("opacity",0),$("#uploadresult").html(upLoadSpeed+"Mbps|"+upLoadSpeedOri),$("#transLine").removeClass("backdashline")}function finishTest(){rect_btn.onclick=setLoadingAnimate,$("#num").html("00.00"),arrow.setAttribute("transform","rotate(-120)"),stopBtnAni(),rect_btn.setAttribute("opacity",1)}function parseSpeedData(t){var e=(8*parseFloat(t)/1024).toFixed(2);return e}function showUserInfo(t){$("#ips").html(t?t.ISP:""),$("#user_position").html(t?t.Lat+"|"+t.Lon:""),$("#ip").html(t?t.Your_IP:"")}function loadingServerInfo(){}function showServerInfo(t){$("#best_server_url").prop("href",t?t.Best_Server_URL:""),$("#country_name").html(t?t.Country+" "+t.Name:""),$("#dist").html(t?t.Dist:""),$("#server_position").html(t?t.Lat+"|"+t.Lon:""),$("#sponsor").html(t?t.Sponsor:""),$("#servercount").html(t?t.serverCount:"")}function loadingPing(){}function showPingResult(t){$("#pingresult").html(t||"")}function addPlaceholder0(t){t=t.toFixed(2);var e=""+t;return e.length<5?4==e.length?t<10?e="0"+e:e+="0":3==e.length?e="0"+e+"0":2==e.length?e+=".00":1==e.length&&(e="0"+e+".00"):e=e.slice(0,6),e}function parsePoints(t,e){if(e){if(maxData<Math.max.apply(Math,t)){maxData=Math.max.apply(Math,t);for(var a=[],r=0;r<downLoadSpeedArr.length;r++){var o=-200+40*r+","+(40-80*downLoadSpeedArr[r]/maxData);a.push(o)}downloadChartStr=parseChartStr(a),downloadPolyStr=parsePolyStr(a),setChartPoints()}}else maxData=Math.max.apply(Math,t);for(var n=[],r=0;r<t.length;r++){var o=-200+40*r+","+(40-80*t[r]/maxData);n.push(o)}return n}function parseChartStr(t){var e="";if(t.length>1)for(var a=0;a<t.length;a++)e+=0==a?"M"+t[a]:"L"+t[a];return e}function parsePolyStr(t){var e="-200,40 ";if(t.length>1)for(var a=0;a<t.length;a++)e+=t[a]+" ";return e+=40*(t.length-1)-200+",40"}function setChartPoints(t){if(t){var e=uploadPlot.getElementsByTagName("path")[0];e.setAttribute("d",uploadChartStr);var a=uploadPlot.getElementsByTagName("polygon")[0];a.setAttribute("points",uploadPolyStr)}else{var r=downloadPlot.getElementsByTagName("path")[0];r.setAttribute("d",downloadChartStr);var o=downloadPlot.getElementsByTagName("polygon")[0];o.setAttribute("points",downloadPolyStr)}}function setSVGSize(){var t,e,a,r,o=document.getElementById("svg_container").clientWidth,n=document.getElementById("dashbox"),d=document.getElementById("dashboxContent");o>800?(t=800,r=1):o<=800&&o>=750?(t=o,r=1):o<750&&(t=o,r=1.5),e=3*t/5*r,a=t/800*r,n.setAttribute("width",t),n.setAttribute("height",e),d.setAttribute("transform","translate("+t/2+","+e/2+") scale("+a+","+a+")"),d.setAttribute("opacity","1");var l=document.getElementById("chartbox"),s=document.getElementById("chart");o>=440?(l.setAttribute("width",400),s.setAttribute("transform","translate(200,40)")):o<440&&o>40&&(l.setAttribute("width",o-40),s.setAttribute("transform","translate("+(o-40)/2+",40) scale("+(o-40)/400+","+(o-40)/400+")"))}function stopBtnAni(){function t(){function t(){r<10&&(a.setAttribute("rx",10),e.setAttribute("opacity",1),clearInterval(rxInterval)),r--,l+=.1,a.setAttribute("rx",r),e.setAttribute("opacity",l)}if(o>100){clearInterval(d);var r=30,l=0;rxInterval=setInterval(t,5)}o+=1,n-=.5,a.setAttribute("width",o),a.setAttribute("x",n)}clearInterval(rotateInterval);var e=document.getElementById("btn_text"),a=document.getElementById("btn_rect"),r=document.getElementById("inner-cir");r.setAttribute("opacity",0),r.setAttribute("stroke-dasharray",""),a.setAttribute("stroke-dasharray",""),a.setAttribute("transform","rotate(0)");var o=60,n=-30,d=setInterval(t,5)}function setBtnAni(){function t(){function t(){function t(){function t(){r.setAttribute("transform","rotate("+e+")"),o.setAttribute("transform","rotate("+a+")"),e+=.5,a-=1,e>360&&(e=1),a<1&&(a=360)}if(r.setAttribute("stroke-dasharray",h),o.setAttribute("stroke-dasharray",c),h<u?h+=u/20:(h=u,clearInterval(m)),c<p)c+=p/20;else{c=p,clearInterval(m),rotateInterval=setInterval(t,5);var e=1,a=360}}if(d>30){a.setAttribute("rx",30),clearInterval(e);var r=document.getElementById("inner-cir");r.setAttribute("opacity",1);var o=a,n=30,l=20,s=2*n*Math.PI,i=2*l*Math.PI,u=s/6,p=i/8,h=0,c=0,m=setInterval(t,50)}d++,a.setAttribute("rx",d)}if(r<60){a.setAttribute("width",60),a.setAttribute("x",-30),clearInterval(n);var e=setInterval(t,5),d=10}r-=1,o+=.5,a.setAttribute("width",r),a.setAttribute("x",o)}var e=document.getElementById("btn_text");e.setAttribute("opacity",0);var a=document.getElementById("btn_rect"),r=100,o=-50,n=setInterval(t,5)}function hideBtn(){function t(){e<0?(rect_btn.setAttribute("opacity",0),clearInterval(a)):(e-=.1,rect_btn.setAttribute("opacity",e))}var e=1,a=setInterval(t,50)}function setLoadingAnimate(){showUserInfo(),showServerInfo(),showPingResult(),$("#downloadresult").html(""),$("#uploadresult").html(""),downLoadSpeedArr=[],upLoadSpeedArr=[],downloadChartStr="",downloadPolyStr="",uploadChartStr="",uploadPolyStr="",setChartPoints(!0),setChartPoints(!1),setBtnAni(),rect_btn.onclick=null,getTestData()}var tcp_delay,downLoadSpeedArr=[],upLoadSpeedArr=[],downLoadSpeed,upLoadSpeed,downLoadSpeedOri,upLoadSpeedOri,downloadPlot=document.getElementById("downLoadPlot"),uploadPlot=document.getElementById("upLoadPlot"),arrow=document.getElementById("arrow"),downloadtext=document.getElementById("downloadtext"),uploadtext=document.getElementById("uploadtext"),maxData,downloadPoint=[],uploadPoint=[],downloadChartStr,downloadPolyStr,uploadChartStr,uploadPolyStr,rect_btn=document.getElementById("rect_btn"),rotateInterval;rect_btn.onclick=setLoadingAnimate,setSVGSize(),Ha.setFooterPosition();