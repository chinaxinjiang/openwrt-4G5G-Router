function initPage(){$.post("/","app=port-remote&action=get_setting",function(t){makePage(t),Data=t},"json"),$.post("/","app=port-remote&action=get_certs",function(t){setDem(t)},"json")}function setDem(t){$(".cret-select").empty(),$("#certs-container").empty();for(var e=0;e<t.length;e++){var a='<option value="'+t[e]+'">'+t[e]+"</option>";$(".cret-select").append(a);var n="<tr><td>"+t[e]+'</td><td><a href="/?app=port-remote&action=dl_cert&cert_file='+t[e]+'"><button class="btn btn-xs btn-primary download-cert-btn" data-name="'+t[e]+'">'+UI.Download+'</button></a></td><td><button class="btn btn-danger btn-xs remove-cert-btn" data-name="'+t[e]+'">'+UI.Del+"</button></td></tr>";$("#certs-container").append(n)}Ha.setFooterPosition()}function makePage(t){$("#switch_port_remote").prop("checked",!!t.enabled);var e=t.Client;$("#client-container").empty();for(var a=0;a<e.length;a++){var n='<tr data-id="'+a+'"><td>'+e[a].comm_port+"</td><td>"+e[a].port+"</td><td>"+e[a].src_host+"</td><td>"+e[a].dest_host+"</td><td>"+e[a].common_num+"</td><td>"+e[a].pem+'</td><td><div class="switch-ctrl switch-sm"><input type="checkbox" '+(e[a].enabled?"checked":"")+' id="client_switch_'+a+'"><label for="client_switch_'+a+'"><span></span></label></div></td><td><button class="btn btn-xs btn-primary" data-toggle="modal" data-target="#clientModal">'+UI.Edit+'</button><button class="btn btn-xs btn-danger remove-client">'+UI.Del+"</button></td></tr>";$("#client-container").append(n)}var r=t.Server;$("#server-container").empty();for(var a=0;a<r.length;a++){var n='<tr data-id="'+a+'"><td>'+r[a].comm_port+"</td><td>"+r[a].port+"</td><td>"+r[a].common_num+"</td><td>"+r[a].pem+'</td><td><div class="switch-ctrl switch-sm"><input type="checkbox" '+(r[a].enabled?"checked":"")+' id="server_switch_'+a+'"><label for="server_switch_'+a+'"><span></span></label></div></td><td><button class="btn btn-xs btn-primary" data-toggle="modal" data-target="#serverModal">'+UI.Edit+'</button><button class="btn btn-xs btn-danger remove-server">'+UI.Del+"</button></td></tr>";$("#server-container").append(n)}Ha.setFooterPosition()}function showClientForm(t,e){for(var a in t)$("#"+e).find('[name="'+a+'"]').val(t[a])}function saveData(t,e,a,n){console.log(arguments),"add"===t?Data[e].push(a):Data[e][n]=a,$(".modal").modal("hide"),makePage(Data)}function savePage(){$.post("/","app=port-remote&action=set_port_remote&data="+JSON.stringify(Data),function(t){$("#confirmModal").modal("hide"),Ha.showNotify(t)},"json")}function removeItem(t,e){for(var a=[],n=0;n<Data[t].length;n++)n!=e&&a.push(Data[t][n]);Data[t]=a,makePage(Data)}function setProgressLength(){var t=$("#file_name").width();t<208&&(t=208),$(".upload-progress-bar").css("width",t).removeClass("hidden")}var Data=null;initPage(),$("#client-container").delegate('[data-target="#clientModal"]',"click",function(){var t=$(this).parent().parent().attr("data-id"),e=Data.Client[t];$("#clientModal").find('[type="submit"]').attr("data-type","edit-Client").attr("data-id",t),showClientForm(e,"clientModal"),$("#client-form").find("[data-validate]").trigger("blur")}),$("#server-container").delegate('[data-target="#serverModal"]',"click",function(){var t=$(this).parent().parent().attr("data-id"),e=Data.Server[t];$("#serverModal").find('[type="submit"]').attr("data-type","edit-Server").attr("data-id",t),showClientForm(e,"serverModal"),$("#server-form").find("[data-validate]").trigger("blur")}),$("#add-client-btn").click(function(){var t={enabled:1,comm_port:"",port:"",common_num:"",pem:"",src_host:"",dest_host:""};$("#clientModal").find('[type="submit"]').attr("data-type","add-Client").attr("data-id","new"),showClientForm(t,"clientModal")}),$("#add-server-btn").click(function(){var t={enabled:1,comm_port:"",port:"",common_num:"",pem:""};$("#serverModal").find('[type="submit"]').attr("data-type","add-Server").attr("data-id","new"),showClientForm(t,"serverModal")}),$(".submit-rule").click(function(t){t.preventDefault();var e=$(this).attr("data-type");e=e.split("-");var a,n=$(this).attr("data-id"),r=null;if("Server"===e[1]){if(a=$("#server-form"),a.find("[data-validate]").trigger("blur"),$(this).parent().parent().find(".has-error").length>0)return;console.log(a),r={enabled:parseInt(a.find('[name="enabled"]').val()),comm_port:parseInt(a.find('[name="comm_port"]').val()),port:parseInt(a.find('[name="port"]').val()),common_num:parseInt(a.find('[name="common_num"]').val()),pem:a.find('[name="pem"]').val()}}else{if(a=$("#client-form"),a.find("[data-validate]").trigger("blur"),$(this).parent().parent().find(".has-error").length>0)return;r={enabled:parseInt(a.find('[name="enabled"]').val()),comm_port:parseInt(a.find('[name="comm_port"]').val()),port:parseInt(a.find('[name="port"]').val()),common_num:parseInt(a.find('[name="common_num"]').val()),pem:a.find('[name="pem"]').val(),src_host:a.find('[name="src_host"]').val(),dest_host:a.find('[name="dest_host"]').val()}}console.log(r),saveData(e[0],e[1],r,n)}),$("#client-container").delegate('[type="checkbox"]',"click",function(){var t=$(this).parent().parent().parent().attr("data-id"),e=$(this).prop("checked")?1:0;Data.Client[t].enabled=e}),$("#server-container").delegate('[type="checkbox"]',"click",function(){var t=$(this).parent().parent().parent().attr("data-id"),e=$(this).prop("checked")?1:0;Data.Server[t].enabled=e}),$("#resetPage-btn").click(initPage),$("#confirm-save-btn").click(savePage),$("[data-validate]").bind("keyup blur change",Validate.checkInput),$("#client-container").delegate(".remove-client","click",function(){var t=$(this).parent().parent().attr("data-id");console.log(t),removeItem("Client",t)}),$("#server-container").delegate(".remove-server","click",function(){var t=$(this).parent().parent().attr("data-id");console.log(t),removeItem("Server",t)}),$("#switch_port_remote").click(function(){var t=$("#switch_port_remote").prop("checked");t?Data.enabled=1:Data.enabled=0}),$(".submit-cert").click(function(){var t=$(this).parent().parent();if(t.find("[data-validate]").trigger("blur"),!($(this).parent().parent().find(".has-error").length>0)){var e=t.serialize();return $.post("/","app=port-remote&action=mk_cert&"+e,function(t){Ha.showNotify(t),$("#certModal").modal("hide"),initPage()},"json"),!1}}),$("#SSL_C").bind("keyup blur",function(){var t=$(this).prop("id"),e=$($(this).get(0).form),a=e.find(".form-group:has(#"+t+")"),n=$(this).val(),r=0;n.length>0&&2!==n.length&&(r=1),r?(a.addClass("has-error"),a.find(".help-block").removeClass("hidden")):(a.removeClass("has-error"),a.find(".help-block").addClass("hidden")),Validate.setSubmitBtn(e)}),$("#certs-container").delegate(".remove-cert-btn","click",function(){var t=$(this).attr("data-name");$.post("/","app=port-remote&action=del_cert&cert_file="+t,function(t){Ha.showNotify(t),t.status||initPage()},"json")}),$("#upload-cert-btn").click(function(){$("#upload-fw").val(""),$("#file_name").html(UI.Upload_File),$("#file_info").addClass("hidden")}),$("#uploader").ajaxForm({uploadProgress:function(t,e,a,n){var r=n+"%";$(".upload-progress-bar").find("span").css("width",r),$("#progress-text").html(r)},complete:function(t){console.log(t.responseText);var e=$.parseJSON(t.responseText);e.status=parseInt(e.status),e.seconds=parseInt(e.seconds),Ha.showNotify(e),setTimeout(function(){window.location.href=e.jump_url},e.seconds),$("#uploadModal").modal("hide")}}),$("#upload-fw").change(function(){$("#submit-file-btn").prop("disabled",!1);var t=$(this).val(),e=t.split("\\").pop();$("#file_name").html(e);var a=$(this).get(0).files[0];if(a){$("#file_info").removeClass("hidden");var n=0;n=a.size>1048576?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB",$("#file_size").html(n||""),$("#file_type").html(a.type||"")}}),$("#uploader").submit(function(){$("#upload-fw").prop("disabled",!0),setProgressLength(),$("#submit-file-btn").prop("disabled",!0)});