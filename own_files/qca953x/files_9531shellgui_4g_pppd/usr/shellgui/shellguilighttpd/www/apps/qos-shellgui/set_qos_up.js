!function(){function a(t){$("#cl_roles_container").empty();for(var e=0;e<t.length;e++){var r=[];for(var s in t[e])if("Set_Service_Class_To"!=s&&"order"!=s){var l=UI[s]?UI[s]:s.replace(/_/g," ");r.push("<p>"+l+": "+t[e][s]+"</p>")}r.sort();var d=r.join(""),o=getClassName(t[e].Set_Service_Class_To,classes),n='<tr class="text-left" id="rule_num_'+t[e].order+'"><td>'+d+"</td><td>"+o+'</td><td><button class="btn btn-info btn-xs edit_rule_btn" data-data=\''+JSON.stringify(t[e])+'\' data-toggle="modal" data-target="#ruleModal">'+UI.Edit+'</button></td><td><button class="btn btn-danger btn-xs remove_rule_btn" data-order="order_'+t[e].order+'">'+UI.Remove+'</button></td><td><button class="btn btn-info btn-xs move_up_btn" data-order="order_'+t[e].order+'"><span class="icon-arrow-up"></span></button></td><td><button class="btn btn-info btn-xs move_down_btn" data-order="order_'+t[e].order+'"><span class="icon-arrow-down"></span></button></td></tr>';$("#cl_roles_container").append(n)}$(".edit_rule_btn").click(function(){$("#ruleModal").find(".modal-title").html(UI.Edit_QoS_Classification_Rule),$("#ruleModal").find(".has-error").removeClass("has-error"),$("#ruleModal").find(".help-block").addClass("hidden"),$("#rule_form").prop("name","editRuleForm"),$("#submit_rule_btn").prop("disabled",!1),resetForm("rule_form");var a=$(this).attr("data-data"),a=JSON.parse(a);for(var t in a){var e=$("#rule_form").find('[name="'+t+'"]');e.prop("disabled",!1),"order"!=t&&e.parent().parent().parent().find('[type="checkbox"]').prop("checked",!0),"text"==e.prop("type")||"hidden"==e.prop("type")?e.val(a[t]):(e.find("option").prop("selected",!1),e.find('[value="'+a[t]+'"]').prop("selected",!0))}}),$(".remove_rule_btn").click(function(){var t=$(this).attr("data-order").replace("order_","");rule_data=removeRule(t,rule_data),a(rule_data)}),$(".move_up_btn").click(function(){var t=parseInt($(this).attr("data-order").replace("order_",""));rule_data=moveRuleUp(t,rule_data),a(rule_data)}),$(".move_down_btn").click(function(){var t=parseInt($(this).attr("data-order").replace("order_",""));rule_data=moveRuleDown(t,rule_data),a(rule_data)})}function t(a){$("#service_class_container").empty();for(var e=0;e<a.length;e++){var r,s;r=a[e].min_bw?a[e].min_bw:"zero",s=a[e].max_bw?a[e].max_bw:"nolimit";var l='<tr class="text-left"><td>'+a[e].name+"</td><td>"+a[e].percent+"%</td><td>"+r+"</td><td>"+s+'</td><td class="load_container" data-class="'+a[e]["class"]+'"></td><td><button class="btn btn-info btn-xs edit_class_btn" data-data=\''+JSON.stringify(a[e])+'\' data-toggle="modal" data-target="#classModal">'+UI.Edit+'</button></td><td><button class="btn btn-danger btn-xs remove_class_btn" data-name="'+a[e].name+'">'+UI.Remove+"</button></td></tr>";$("#service_class_container").append(l)}$(".load_container").each(function(a){for(var t=$(this).attr("data-class"),e=0;e<load.bps.length;e++)t-1==e&&$(this).html(bpsToKbpsString(load.bps[t-1]))}),$(".edit_class_btn").click(function(){$("#classModal").find(".modal-title").html(UI.Edit_QoS_Service_Class),$("#classModal").find(".help-block").addClass("hidden"),$("#classModal").find(".has-error").removeClass("has-error"),$("#class_form").attr("data-name","EditClassForm"),$("#submit_class_btn").prop("disabled",!1),resetForm("class_form");var a=$(this).attr("data-data"),a=JSON.parse(a);for(var t in a){var e=$("#class_form").find('[name="'+t+'"]');a[t]&&(e.val(a[t]),e.prop("disabled",!1),e.parent().parent().parent().find(".has_field").prop("checked",!0))}}),$(".remove_class_btn").click(function(){var a=$(this).attr("data-name");service_class_data=removeSerClass(a,service_class_data),t(service_class_data)})}function e(){var t=$("#rule_form").serializeArray();t=formatData(t);for(var e=0;e<rule_data.length;e++)rule_data[e].order==t.order&&(rule_data[e]=t);a(rule_data)}function r(){var t=$("#rule_form").serializeArray(),e=formatData(t);return e.order=rule_data.length+1,rule_data.push(e),a(rule_data),!1}function s(){var a=$("#class_form").serializeArray(),e=formatData(a);return e.max_bw||(e.max_bw=0),e.min_bw||(e.min_bw=0),service_class_data.push(e),t(service_class_data),!1}function l(){var a=$("#class_form").serializeArray();a=formatData(a),a.max_bw||(a.max_bw=!1),a.min_bw||(a.min_bw=!1);for(var e=0;e<service_class_data.length;e++)if(service_class_data[e].name===a.name){var r=service_class_data[e]["class"];service_class_data[e]=a,service_class_data[e]["class"]=r}return t(service_class_data),!1}function d(){$.post("/","app=qos-shellgui&action=get_qos_upload",function(e){origin_data=e.rule_data,rule_data=mapRuleData(origin_data),service_class_data=e.class_data,load=initLoadPbs(service_class_data),classes=getClassId(service_class_data),default_class=e.upload_default_class,total_bw=e.upload_total_bandwidth,a(rule_data),makeDefaultClass(classes,"up"),t(service_class_data),0==total_bw&&($("#page_switch").prop("checked",!1),$("input,button,select").prop("disabled",!0),$(".gotop-widget").find("button").prop("disabled",!1),$("#page_switch").prop("disabled",!1),clearInterval(updateLoadInterval)),$("#default_class").find("option").each(function(){$(this).val()==default_class?$(this).prop("selected",!0):$(this).prop("selected",!1)}),$("#total_bw").val(total_bw)},"json")}d(),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3),$("#page_submit").click(function(){Ha.mask.show();for(var a={app:"qos-shellgui",action:"set_upload",rule_data:unmapRuleData(rule_data),class_data:service_class_data,upload_total_bandwidth:$("#total_bw").val(),upload_default_class:$("#default_class").val()},t=0,e=0;e<a.class_data.length;e++)t+=parseInt(a.class_data[e].percent);return 100!=t?(Ha.mask.hide(),void Ha.showNotify({status:1,msg:UI.total_pct_warning})):(clearInterval(updateLoadInterval),void $.post("/",a,function(a){Ha.mask.hide(),Ha.showNotify(a),d(),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3)},"json"))}),$("#page_switch").click(function(){var e=$(this).prop("checked");e?($("input,button,select").prop("disabled",!1),total_bw=320,$("#total_bw").val(total_bw),$.post("/","app=qos-shellgui&action=total_bandwidth&up_down=upload&total_bw=320",Ha.showNotify,"json"),a(rule_data),makeDefaultClass(classes,"up"),t(service_class_data),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3)):($("input,button,select").prop("disabled",!0),$(".gotop-widget").find("button").prop("disabled",!1),total_bw=0,$("#total_bw").val(total_bw),$.post("/","app=qos-shellgui&action=total_bandwidth&up_down=upload&total_bw=0",Ha.showNotify,"json"),clearInterval(updateLoadInterval)),$("#page_switch").prop("disabled",!1)}),$("#page_reset").click(function(){$(".help-block").addClass("hidden"),$(".has-error").removeClass("has-error"),$("#page_submit").prop("disabled",!1),d()}),$(".has_switch").click(function(){var a=$(this).parent().find(".has_field").prop("checked");$(this).parent().find(".has_field").prop("checked",!a);var t=$(this).prop("for");$("#"+t).prop("disabled",a);var e=$("#"+t).attr("data-validate");e&&switchInputError(a,t)}),$(".has_field").change(function(){var a=$(this).prop("checked"),t=$(this).parent().find(".has_switch").prop("for");$("#"+t).prop("disabled",!a).focus();var e=$("#"+t).attr("data-validate");e&&switchInputError(a,t)}),$("form").submit(function(){return!1}),$("#add_rule_btn").click(function(){$("#ruleModal").find(".modal-title").html(UI.Add_New_Classification_Rule),$("#ruleModal").find(".help-block").addClass("hidden"),$("#ruleModal").find(".has-error").removeClass("has-error"),$("#rule_form").prop("name","addRuleForm"),resetForm("rule_form"),$("#service_class_up").val(default_class),$("#submit_rule_btn").prop("disabled",!1)}),$("#submit_rule_btn").click(function(){var a=0;return $("#ruleModal").find(".help-block").each(function(){$(this).hasClass("hidden")||(a+=1)}),a?($("#submit_rule_btn").prop("disabled",!0),!1):("addRuleForm"==$("#rule_form").prop("name")?r():e(),void $("#ruleModal").modal("hide"))}),$("#add_class_btn").click(function(){$("#classModal").find(".modal-title").html(UI.Add_New_Service_Class),$("#classModal").find(".help-block").addClass("hidden"),$("#classModal").find(".has-error").removeClass("has-error"),$("#class_form").attr("data-name","addClassForm"),resetForm("class_form"),$("#class_form").find('[name="name"],[name="percent"]').prop("disabled",!1),$("#submit_class_btn").prop("disabled",!0),$("#service_class_name").parent().parent().parent().addClass("has-error"),$("#service_class_name").next(".help-block").removeClass("hidden"),$("#percent_bandwidth").parent().parent().parent().addClass("has-error"),$("#percent_bandwidth").parent().next(".help-block").removeClass("hidden")}),$("#submit_class_btn").click(function(){var a=0;return $("#classModal").find(".help-block").each(function(){$(this).hasClass("hidden")||(a+=1)}),($("#service_class_name").val().length<=0||$("#percent_bandwidth").val().length<=0)&&(a+=1),a?($("#submit_rule_btn").prop("disabled",!0),!1):("addClassForm"==$("#class_form").attr("data-name")?s():l(),void $("#classModal").modal("hide"))}),$("[data-validate]").bind("keyup blur",Validate.checkInput),$("#total_bw").bind("keyup blur",function(){var a=$(this).val();Validate.vaInt(a,0)||Validate.vaLength(a)?($(this).parent().parent().parent().addClass("has-error"),$(this).parent().parent().parent().find(".help-block").removeClass("hidden"),$("#page_submit").prop("disabled",!0)):($(this).parent().parent().parent().removeClass("has-error"),$(this).parent().parent().parent().find(".help-block").addClass("hidden"),$("#page_submit").prop("disabled",!1))})}();