function resetData(){setSelectedValue("refresh_rate","10000"),resetVariables(),setInterval(checkForRefresh,500)}function checkForRefresh(){timeSinceUpdate+=500;var e=getSelectedValue("refresh_rate"),e="never"==e?timeSinceUpdate+500:e;(timeSinceUpdate<0||timeSinceUpdate>=e)&&(timeSinceUpdate=0,reloadVariables())}function reloadVariables(){if(!updateInProgress){updateInProgress=!0;var stateChangeFunction=function(req){var jsHostVars=req.replace(/Success/,"");eval(jsHostVars),resetVariables(),updateInProgress=!1};$.post("/","app=hosts&action=define_host_vars",stateChangeFunction)}}function resetVariables(){if("1"!=uciOriginal.get("dhcp","lan","ignore")){$("#dhcp_data").removeClass("hidden");var e=([UI.HsNm,hostsStr.HostIP,hostsStr.HostMAC,hostsStr.LeaseExp],createTr(parseDhcp(dhcpLeaseLines)));$("#dhcp_container").empty(),$("#dhcp_container").append(e),Ha.setFooterPosition()}else $("#dhcp_data").addClass("hidden");var t=parseArp(arpLines,dhcpLeaseLines),r=!1,n=uciOriginal.getAllSectionsOfType("wireless","wifi-iface"),s=0;for(s=0;s<n.length;s++)r="ap"==uciOriginal.get("wireless",n[s],"mode")||r;var a=uciOriginal.getAllSectionsOfType("wireless","wifi-device");if(r=r&&"1"!=uciOriginal.get("wireless",a[0],"disabled")){$("#wifi_data").removeClass("hidden");var e=([UI.HsNm,hostsStr.HostIP,hostsStr.HostMAC,hostsStr.Band,"TX "+hostsStr.Bitrate,"RX "+hostsStr.Bitrate,hostsStr.Signal],createTr(parseWifi(t,wirelessDriver,wifiLines)));$("#wifi_container").empty(),$("#wifi_container").append(e),Ha.setFooterPosition()}else $("#wifi_data").addClass("hidden");var e=([UI.HsNm,hostsStr.HostIP,hostsStr.HostMAC,hostsStr.ActiveConx,hostsStr.RecentConx,hostsStr.UDPConx],createTr(parseConntrack(t,currentWanIp,conntrackLines)));$("#active_container").empty(),$("#active_container").append(e),Ha.setFooterPosition(),$(".loading").addClass("hidden")}function getHostname(e){var t=null==ipToHostname[e]?"("+UI.unk+")":ipToHostname[e];return t=t.length<25?t:t.substr(0,22)+"..."}function parseDhcp(e){var t=[],r=0;for(r=0;r<e.length;r++){var n=e[r],s=n.split(/[\t ]+/),a=s[0],o=s[1].toUpperCase(),i=s[2],l=getHostname(i),p=a-currentTime,c=Math.floor(p/3600),d=Math.floor((p-60*c*60)/60);d<10&&(d="0"+d);var u=c+"h "+d+"m";t.push([l,i,o,u])}return sort2dStrArr(t,1),t}function parseArp(e,t){var r=[];e.shift();var n=0;for(n=0;n<e.length;n++){var s=e[n],a=s.split(/[\t ]+/),o=a[3].toUpperCase(),i=a[0];r[o]=i,r[i]=o}for(n=0;n<t.length;n++){var l=t[n],p=l.split(/[\t ]+/),o=p[1].toUpperCase(),i=p[2];r[o]=i,r[i]=o}return r}function sort2dStrArr(e,t){var r=function(e,r){return e[t]==r[t]?0:e[t]<r[t]?-1:1};e.sort(r)}function parseWifi(e,t,r){if(""==t||0==r.length)return[];var n=[],s=0;for("atheros"==t&&r.shift(),s=0;s<r.length;s++){var a=r[s],o=a.split(/[\t ]+/),i=[[o[1],"0","0"],[o[0],o[3],o[5]],[o[0],o[2],o[1],o[3],o[4]]],l="broadcom"==t?i[0]:"atheros"==t?i[1]:i[2];l[0]=l[0].toUpperCase(),l[1]=l[1]+" Mbps";var p=function(e){var t=parseInt(e).toString(16).toUpperCase();return t=t.length<2?"0"+t:t.substr(0,2)},c=parseInt(l[2]),d=c<-80?"#AA0000":"";d=c>=-80&&c<-70?"#AA"+p(170*((c+80)/10))+"00":d,d=c>=-70&&c<-60?"#"+p(170-170*(c+70)/10)+"AA00":d,d=c>=-60?"#00AA00":d;var u='<span style="color: '+d+';">'+l[2]+" dBm</span>";l[2]=u;var h=null==e[l[0]]?UI.unk:e[l[0]],f=getHostname(h);l.length>3?(l[3]=l[3]+" Mbps",n.push([f,h,l[0],l[4],l[1],l[3],l[2]])):n.push([f,h,l[0],"-",l[1],"-",l[2]])}return sort2dStrArr(n,1),n}function parseConntrack(e,t,r){var n=[],s=[],a=[],o=[],i=0;for(i=0;i<r.length;i++){var l=r[i],p=l.split(/src=/),c=p[1],d=c.split(/[\t ]+/),u=d[0];p=l.split(/dst=/);var h=p[1],f=h.split(/[\t ]+/),v=f[0];p=l.split(/[\t ]+/);var g=p[0].toLowerCase();if("tcp"==g){var I=p[3].toUpperCase(),m="TIME_WAIT"==I||"CLOSE"==I?"closed":"open";g=g+"-"+m}if(a[u+"-"+g]=null==a[u+"-"+g]?1:a[u+"-"+g]+1,"udp"==g){a[u+"-"+g]}null==s[u]&&u!=t&&u!=currentLanIp&&v!=t&&"0.0.0.0"!=u&&(o.push(u),s[u]=1)}var S=0;for(S=0;S<o.length;S++){var C=o[S],U=null==e[C]?UI.unk:e[C],A=null==a[C+"-tcp-open"]?0:a[C+"-tcp-open"],H=null==a[C+"-tcp-closed"]?0:a[C+"-tcp-closed"],x=null==a[C+"-udp"]?0:a[C+"-udp"],_=getHostname(C);n.push([_,C,U,""+A,""+H,""+x])}return sort2dStrArr(n,1),n}function createTr(e){for(var t=[],r=0;r<e.length;r++){for(var n="",s=0;s<e[r].length;s++)n+="<td>"+e[r][s]+"</td>";t.push(n)}for(var a="",o=0;o<t.length;o++)a+='<tr class="text-left">'+t[o]+"</tr>";return a}function setSelectedValue(e,t,r){var r=null==r?document:r,n=r.getElementById(e);null==n&&console.log(UI.Err+": "+e+" "+UI.nex);var s=!1;for(optionIndex=0;optionIndex<n.options.length&&!s;optionIndex++)s=n.options[optionIndex].value==t,s&&(n.selectedIndex=optionIndex);!s&&n.options.length>0&&n.selectedIndex<0&&(n.selectedIndex=0)}function getSelectedValue(e,t){return t=null==t?document:t,null==t.getElementById(e)?void alert(UI.Err+": "+e+" "+UI.nex):(selectedIndex=t.getElementById(e).selectedIndex,selectedValue="",selectedIndex>=0&&(selectedValue=t.getElementById(e).options[t.getElementById(e).selectedIndex].value),selectedValue)}function getParameterDefinition(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}var hostsStr=new Object,updateInProgress=!1,timeSinceUpdate=-5e3;resetData();