function pieChart(){function t(t,e){l||(l=r.append("g").attr("transform","translate(150,150)").classed("pie",!0));var d=l.selectAll("path").data(t(i));d.exit().remove(),d.transition().duration(1e3).attrTween("d",function(t){var a=this.__current__;a||(a={startAngle:0,endAngle:0});var n=d3.interpolate(a,t);return this.__current__=n(1),function(t){return e(n(t))}}),d.enter().append("path").attr("fill",function(t,e){return"hsl("+20*(e+1)+",80%,50%)"}).attr("opacity",.72).attr("data-index",function(t,e){return e}).attr("stroke","white").attr("stroke-width",1.2).transition().duration(1e3).attrTween("d",function(t){var a=this.__current__;a||(a={startAngle:0,endAngle:0});var n=d3.interpolate(a,t);return this.__current__=n(1),function(t){return e(n(t))}}),d.on("mouseenter",function(t,e){var n=d3.select(this).attr("data-index");d3.selectAll('[data-index="'+n+'"]').attr("transform","scale(1.15,1.15)"),d3.select('[data-label="'+n+'"]').style({"background-color":"hsl("+20*(e+1)+",80%,50%)",color:"white"}),a(i[e])}).on("click",function(t,e){var n=d3.select(this).attr("data-index");d3.selectAll('[data-index="'+n+'"]').attr("transform","scale(1.15,1.15)"),d3.select('[data-label="'+n+'"]').style({"background-color":"hsl("+20*(e+1)+",80%,50%)",color:"white"}),a(i[e])}).on("mouseleave",function(t,e){var a=d3.select(this).attr("data-index");d3.selectAll('[data-index="'+a+'"]').attr("transform","scale(1,1)"),d3.select('[data-label="'+a+'"]').style({"background-color":"transparent",color:"#333"}),n()})}function e(){d||(d=r.append("g").classed("label-detailed",!0).attr("transform","translate(150,150)")),d.select("text.type")[0][0]||d.append("text").html(_container).classed("type",!0).attr({dy:0,"text-anchor":"middle","font-size":"18px",opacity:"0.72"})}function a(t){d3.selectAll(".label-detailed").select(".type").transition().duration(500).attr("dy",-20),d3.selectAll(".label-detailed").selectAll(".desc").transition().duration(500).attr({dy:50,opacity:0}).remove();for(var e=["total","up","down"],a=0;a<3;a++){var n=d3.select("#"+e[a]).select(".label-detailed");n.append("text").html(t.label).classed("desc",!0),n.append("text").classed("desc",!0).html(t[e[a]]+"|"+t[e[a]+"_pct"]).attr("dy",20),n.selectAll("text.desc").attr({"text-anchor":"middle","font-size":"14px",opacity:"0.72"})}}function n(){d3.selectAll(".label-detailed").select(".type").transition().duration(500).attr("dy",0),d3.selectAll(".label-detailed").selectAll(".desc").attr("fill","#ccc").transition().duration(500).attr({dy:50,opacity:0,transform:"scale(0.1,0.1)"}).remove()}var r,l,d,i,o={},c=d3.svg.arc().outerRadius(120).innerRadius(72),s=d3.layout.pie().sort(null).value(function(t){return t[_container+"_data"]});return o.container=function(t){return _container=t,o},o.data=function(t){return i=t,o},o.render=function(){return r||(r=d3.select("#"+_container).append("svg").attr({viewBox:"0,0,300,300"})),t(s,c),e(),o},o.reset=function(){return $("#"+_container).empty(),o},o.renderLabels=function(){var t=d3.select("#label-container").selectAll("div.pie-labels").data(i);return t.exit().remove(),t.html(function(t){return t.label}),t.enter().append("div").classed("pie-labels",!0).attr("data-label",function(t,e){return e}).html(function(t){return t.label}).style("border-bottom",function(t,e){return"6px solid hsl("+20*(e+1)+",80%,50%)"}),d3.selectAll("div.pie-labels").on("mouseenter",function(t,e){d3.select(this).style({"background-color":"hsl("+20*(e+1)+",80%,50%)",color:"white"}),d3.selectAll('[data-index="'+e+'"]').attr("transform","scale(1.15,1.15)"),a(t)}).on("mouseleave",function(t,e){d3.select(this).style({"background-color":"transparent",color:"#333"}),d3.selectAll('[data-index="'+e+'"]').attr("transform","scale(1,1)"),n()}),o},o}function initPies(t){totalPie=pieChart().container("total").reset().data(t).render().renderLabels(),downPie=pieChart().container("down").reset().data(t).render(),upPie=pieChart().container("up").reset().data(t).render()}function updatePies(t){totalPie.data(t).container("total").render().renderLabels(),downPie.data(t).container("down").render(),upPie.data(t).container("up").render()}var totalPie,downPie,upPie;