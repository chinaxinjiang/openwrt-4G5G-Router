!function(){function t(t){var i=$('[data-form="5g_form"]').find('[name="htmode"]').val();console.log(i);var n=$('[data-form="5g_form"]').find('[name="htmode"]').prop("id").replace("ht_",""),e={HT20:[36,40,44,48,149,153,157,161,165],"HT40+":[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,149,153,157,161],VHT80:[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,149,153,157,161]},s=a(e[i]);if($("#channel_"+n).empty().append(s),t){var o=$("#channel_"+n).attr("data-channel");$("#channel_"+n).val(o)}}function a(t){for(var a="",i=0;i<t.length;i++)a+='<option value="'+t[i]+'">'+t[i]+"</option>";return a}function i(t,a){$("#"+a+"_key").removeClass("hidden").removeClass("has-error"),"none"!=$("#encryption_"+a).val()?t||$("#"+a+"_key").find("input").focus().val(""):($("#"+a+"_key").addClass("hidden"),$("#"+a+"_key").next(".help-block").addClass("hidden")),$("#"+a+"_key").find(".help-block").addClass("hidden"),Validate.setSubmitBtn($("#ssid_set_"+a)),Ha.setFooterPosition()}var n=[];$('[name="nic-switch"]').each(function(){var t=$(this).prop("id").split("_").pop();n.push(t)});for(var e in n)$("#switch_"+n[e]).prop("checked")||(Ha.disableForm("wifi_set_"+n[e]),$("#ssid_item_"+n[e]).addClass("hidden"),$("#switch_"+n[e]).parent().removeAttr("data-toggle"),$("#wifi_set_"+n[e]).parent().css("border-bottom-width","0px"));var s=[];$('[name="ssid-switch"]').each(function(){var t=$(this).prop("id").replace("switch_","");s.push(t)});for(var e in s)$("#switch_"+s[e]).prop("checked")||(Ha.disableForm("ssid_set_"+s[e]),$("#switch_"+s[e]).parent().removeAttr("data-toggle"));var o=$('[data-form="5g_form"]').find('[name="channel"]').attr("data-channel");o&&(t(!0),$('[data-form="5g_form"]').find('[name="htmode"]').change(function(){t(!1)})),$('[name="encryption"]').each(function(){var t=$(this).prop("id").replace("encryption_","");i(!0,t)}),$('[name="encryption"]').change(function(){var t=$(this).prop("id").replace("encryption_","");i(!1,t)});var d,r,c;$('[name="nic-switch"],[name="ssid-switch"]').click(function(){var t=$(this).prop("checked"),a=$(this).parent();if(d=$(this).prop("id").split("_").pop(),r=$(this).prop("name").split("-").shift(),"nic"==r?($("#modal_ensure_text").html(UI.Do_you_want_disable_this_nic),$("#modal_result_text").html(UI.This_will_disable_the_APs)):(r="ap",$("#modal_ensure_text").html(UI.Do_you_want_disable_this_ap),$("#modal_result_text").html(UI.This_will_make_all_client_lost_connection)),c="app=wifi&action=disabled_"+r+"&"+r+"="+d+"&disabled=",!t)return!1;var i=c+0;$.post("/",i,Ha.showNotify,"json"),"nic"==r?(setTimeout(function(){a.attr("data-toggle","modal")},5),Ha.reableForm("wifi_set_"+d),$("#ssid_item_"+d).removeClass("hidden"),$("#wifi_set_"+d).parent().css("border-bottom-width","3px")):(Ha.reableForm("ssid_set_"+d),setTimeout(function(){a.attr("data-toggle","modal")},5))}),$("#disable_btn").click(function(){$(".switch-ctrl").find("#switch_"+d).prop("checked",!1);var t=c+1;$.post("/",t,Ha.showNotify,"json"),"nic"==r?(Ha.disableForm("wifi_set_"+d),$("#ssid_item_"+d).addClass("hidden"),$("#switch_"+d).parent().removeAttr("data-toggle"),$("#wifi_set_"+d).parent().css("border-bottom-width","0px")):(Ha.disableForm("ssid_set_"+d),$("#switch_ctrl_"+d).removeAttr("data-toggle"))}),$("[data-validate]").bind("keyup blur",Validate.checkInput),$('[name="wifi_set"]').submit(function(){var t="app=wifi&action=save_nic&"+$(this).serialize(),a=$(this).prop("id");return Ha.ajax("/","json",t,"post",a,Ha.showNotify,1),!1}),$('[name="ssid_set"]').submit(function(){var t=$(this).prop("id").replace("ssid_set_",""),a=$.trim($(this).find('[name="ssid"]').val()),i=$(this).find('[name="encryption"]').val(),n=$(this).find('[name="key"]').val();if(a.length<2)return!1;if("none"!=i&&n.length<8)return!1;var e=$(this).prop("id"),t=e.split("_").pop(),s="app=wifi&action=save_ap&ap="+t+"&"+$(this).serialize(),o=[];return $(this).find(".mac-text").each(function(){var t=$(this).html();o.push(t)}),s=s+"&maclist="+o.join(","),Ha.ajax("/","json",s,"post",e,Ha.showNotify,1),!1}),$('[name="ssid_set"]').each(function(){var t=$(this);t.find(".add-mac-input").bind("keyup blur",function(){var a=$(this).val();Validate.vaMac(a)||Validate.vaLength(a)?(t.find(".add-mac-btn").prop("disabled",!0),$(this).parent().parent().find(".help-block").removeClass("hidden"),$(this).parent().parent().parent().addClass("has-error")):(t.find(".add-mac-btn").prop("disabled",!1),$(this).parent().parent().find(".help-block").addClass("hidden"),$(this).parent().parent().parent().removeClass("has-error"))}),t.find(".add-mac-btn").click(function(){var a=$(this).prop("disabled");if(!a){var i=t.find(".add-mac-input").val(),n='<span class="mac-item"><span class="mac-text">'+i+'</span> <span class="icon-cross"></span>&nbsp;&nbsp;</span><wbr>';t.find(".maclist-container").append(n),t.find(".add-mac-input").val(""),$(this).prop("disabled",!0)}return!1})}),$(".hosts-container").each(function(){function t(a){var i=a.attr("data-wnic");$.post("/","app=wifi&action=get_ap_clients&dev="+i,function(t){var n="",e=[];for(var s in t){e.push(s);var o='<tr data-mac="'+s+'"><td>Mac: '+s+"<br>IP: "+t[s].IP+'</td><td><button title="禁用当前mac主机" class="btn btn-danger btn-xs" data-toggle="modal" data-target="#killHostModal"><span class="icon-cross"></span></button><br><button data-wnic="'+i+'" title="将当前mac主机添加到过滤列表" class="btn btn-xs btn-default add-to-maclist"><span class="icon-plus"></span></button></td><td>Rx: '+t[s].rx_bitrate+"<br>Tx: "+t[s].tx_bitrate+"</td><td>"+UI.Percentage+": "+t[s].signal_pct+"%<br>"+UI.Signal+": "+t[s].signal+"</td></tr>";n+=o}a.find("tbody").empty().append(n),0===e.length?a.addClass("hidden"):a.removeClass("hidden")},"json"),setTimeout(function(){t(a)},1e4)}var a=$(this);t(a)}),$("body").delegate('[data-target="#killHostModal"]',"click",function(){var t=$(this).parent().parent().attr("data-mac");$("#killHostModal").find('[name="mac"]').val(t),$("#killHostModal").find("#host-mac").html(t)}),$("body").delegate(".add-to-maclist","click",function(){var t=$(this).parent().parent().attr("data-mac"),a='<span class="mac-item"><span class="mac-text">'+t+'</span> <span class="icon-cross"></span>&nbsp;&nbsp;</span><wbr>',i=$(this).attr("data-wnic");$('[data-maclist-wnic="'+i+'"]').append(a)}),$(".maclist-container").delegate(".icon-cross","click",function(){$(this).parent().remove()}),$("#killHostForm").submit(function(t){t.preventDefault();var a=$(this).serialize(),i="app=wifi&action=kick_out_clients&"+a;console.log(i),$.post("/",i,function(t){Ha.showNotify(t),$("#killHostModal").modal("hide")},"json")})}();